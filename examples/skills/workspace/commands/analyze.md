---
description: 质量验证分析，检查创作一致性和质量
argument-hint: "分析范围，如全部或第1-5章"
allowed-tools: ["Read", "Grep", "Bash"]
models:
  preferred:
    - claude-sonnet-4-5
    - gpt-4-turbo
    - qwen-max
  minimum-capabilities:
    - tool-calling
---

# 质量分析工作流

对已完成的章节进行全面的质量验证和一致性检查。

## 分析目标

1. **一致性验证**：角色、世界观、时间线的一致性
2. **质量评估**：是否符合创作宪法和规格要求
3. **问题识别**：发现并标记需要改进的部分

## 执行流程

### 1. 加载基准文档

**读取参考标准：**

1. **创作宪法**：
   - `memory/constitution.md`（质量标准基准）

2. **规格说明**：
   - `stories/*/specification.md`（目标要求）
   - `stories/*/creative-plan.md`（计划对比）

3. **追踪数据**：
   - `spec/tracking/character-state.json`
   - `spec/tracking/relationships.json`
   - `spec/tracking/plot-tracker.json`
   - `spec/tracking/validation-rules.json`

### 2. 读取待分析内容

根据参数指定的范围，读取相应章节：
- `stories/*/content/` 目录下的章节文件

### 3. 一致性检查

**角色一致性：**
- 物理特征是否保持一致（外貌、年龄等）
- 性格表现是否符合设定
- 知识状态是否合理（角色只知道应该知道的）
- 成长变化是否有合理铺垫

**世界观一致性：**
- 规则设定是否前后矛盾
- 地理位置是否准确
- 社会文化是否稳定
- 能力体系是否遵循既定规则

**时间线一致性：**
- 事件顺序是否合理
- 时间流逝是否匹配
- 同时发生的事件是否协调

### 4. 质量评估

**宪法合规性：**
- ✓ 核心价值观体现
- ✓ 质量标准达成
- ✓ 风格一致性保持

**规格符合度：**
- ✓ P0 元素完整性
- ✓ 目标读者适配度
- ✓ 内容边界遵守

**创作计划执行：**
- ✓ 章节结构完整性
- ✓ 节奏控制合理性
- ✓ 字数达标情况

### 5. 问题识别和分级

**🔴 严重问题（必须修复）：**
- 角色知道不应该知道的信息
- 世界规则明显矛盾
- 时间线逻辑错误
- 违反核心价值观

**⚠️ 警告问题（建议修复）：**
- 角色行为偏离设定
- 细节描述不一致
- 节奏控制欠佳
- 风格偶尔偏离

**📝 注意事项（可选优化）：**
- 表达可以更生动
- 情节可以更紧凑
- 细节可以更丰富

### 6. 生成分析报告

```markdown
## 质量分析报告

**分析范围**：第1-5章
**分析时间**：2024-01-15 14:30

### 一致性检查结果

#### ✅ 通过项
- 角色物理特征：一致
- 世界观规则：稳定
- 时间线逻辑：合理

#### ❌ 问题项

**🔴 严重问题 (2个)**
1. 第3章：主角知道了只在第5章才揭示的信息
   - 位置：第3章第12段
   - 建议：删除该提前认知，或将第5章揭示提前

2. 第4章：魔法系统使用违反第1章建立的规则
   - 位置：第4章第8段
   - 建议：修改为符合规则的使用方式

**⚠️ 警告问题 (5个)**
1. 第2章：配角的眼睛颜色描述与第1章不符
2. 第3章：对话节奏过慢，影响阅读体验
...

### 质量评估结果

**宪法合规性**: 85分
- 核心价值观: ✓ 良好
- 质量标准: ✓ 达标
- 风格一致性: ⚠️ 偶尔偏离（第3章）

**规格符合度**: 90分
- P0 元素: ✓ 完整
- 目标适配: ✓ 符合
- 边界遵守: ✓ 良好

### 改进建议

1. 优先修复2个严重问题
2. 评估5个警告问题，决定是否修复
3. 第3章建议整体review，调整节奏和风格
4. 更新追踪数据，确保后续章节避免类似问题

### 下一步行动

- [ ] 修复严重问题
- [ ] Review第3章
- [ ] 更新character-state.json
- [ ] 继续后续章节创作
```

## 输出格式

分析报告应该：
- **结构化**：清晰分段，方便查阅
- **可操作**：具体指出位置和建议
- **有优先级**：区分严重、警告、注意
- **有总结**：提供整体评估和改进方向

## 与方法论的关系

```
/constitution → 提供质量基准
/specify → 提供评估标准
/plan → 提供执行对比
/write → 产生待分析内容
     ↓
/analyze → 【当前】验证质量
     ↓
根据报告调整 → 改进创作
```

记住：分析是质量保证环节，要客观、具体、有建设性。

