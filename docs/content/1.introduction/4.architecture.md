---
title: æ¶æ„è®¾è®¡
description: æ·±å…¥ç†è§£AgentSDKçš„ä¸‰å±‚æ¶æ„è®¾è®¡
---

# æ¶æ„è®¾è®¡

AgentSDKé‡‡ç”¨çµæ„Ÿæ¥è‡ª[DeepAgents](https://github.com/anthropics/deepagents)çš„ä¸‰å±‚å¯æ‰©å±•æ¶æ„ï¼Œé€šè¿‡æ¸…æ™°çš„åˆ†å±‚å’ŒæŠ½è±¡å®ç°é«˜åº¦å¯æ‰©å±•æ€§ã€‚

## ğŸ—ï¸ æ•´ä½“æ¶æ„

![æ¶æ„æ¦‚è§ˆ](/agentsdk/images/architecture-overview.svg)

### ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agent Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             Middleware Stack                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  SummarizationMiddleware (priority: 40)   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Auto summarize (>170k tokens)         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Keep recent 6 messages                 â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  FilesystemMiddleware (priority: 100)     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Tools: [fs_*, bash_*]                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Auto eviction (>20k tokens)            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  SubAgentMiddleware (priority: 200)       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Tools: [task]                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Context isolation                      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  CustomMiddleware (priority: 500+)        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚ WrapModelCall      â”‚ WrapToolCall            â”‚
â”‚         â–¼                    â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Provider   â”‚      â”‚ Tool Executorâ”‚                â”‚
â”‚  â”‚  (Stream)   â”‚      â”‚  (Execute)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ StateBackend â”‚  â”‚ StoreBackend â”‚  â”‚FilesystemBE  â”‚  â”‚
â”‚  â”‚  (ä¸´æ—¶å†…å­˜)  â”‚  â”‚  (æŒä¹…åŒ–)    â”‚  â”‚  (çœŸå®FS)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                â”‚ CompositeBackend â”‚                     â”‚
â”‚                â”‚   (è·¯ç”±ç»„åˆ)     â”‚                     â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¬¬ä¸€å±‚ï¼šAgentå±‚

è´Ÿè´£Agentçš„æ ¸å¿ƒè¿è¡Œæ—¶é€»è¾‘ï¼š

- **ä¸­é—´ä»¶æ ˆ**ï¼šæ´‹è‘±æ¨¡å‹çš„ä¸­é—´ä»¶ç»„åˆ
- **Provider**ï¼šå¤§æ¨¡å‹APIè°ƒç”¨
- **å·¥å…·æ‰§è¡Œå™¨**ï¼šå·¥å…·è°ƒç”¨å’Œç»“æœå¤„ç†
- **äº‹ä»¶åˆ†å‘**ï¼šProgress/Control/Monitorä¸‰é€šé“

### ç¬¬äºŒå±‚ï¼šBackendå±‚

æä¾›ç»Ÿä¸€çš„å­˜å‚¨æŠ½è±¡ï¼š

- **StateBackend**ï¼šå†…å­˜ä¸´æ—¶å­˜å‚¨
- **StoreBackend**ï¼šæŒä¹…åŒ–å­˜å‚¨
- **FilesystemBackend**ï¼šçœŸå®æ–‡ä»¶ç³»ç»Ÿ
- **VectorBackend**ï¼šå‘é‡å­˜å‚¨ä¸è¯­ä¹‰è®°å¿†(å¯é€‰)
- **CompositeBackend**ï¼šè·¯ç”±ç»„åˆ

### ç¬¬ä¸‰å±‚ï¼šåŸºç¡€è®¾æ–½å±‚

- **Sandbox**ï¼šä»£ç æ‰§è¡Œç¯å¢ƒï¼ˆæœ¬åœ°/äº‘ç«¯ï¼‰
- **Scheduler**ï¼šä»»åŠ¡è°ƒåº¦å™¨
- **Permission**ï¼šæƒé™æ§åˆ¶
- **MCP Client**ï¼šMCPåè®®å®¢æˆ·ç«¯

## ğŸ§… ä¸­é—´ä»¶ç³»ç»Ÿ

ä¸­é—´ä»¶ç³»ç»Ÿæ˜¯AgentSDKçš„æ ¸å¿ƒè®¾è®¡ï¼Œé‡‡ç”¨æ´‹è‘±æ¨¡å‹å®ç°åŠŸèƒ½çš„çµæ´»ç»„åˆã€‚

![ä¸­é—´ä»¶æ´‹è‘±æ¨¡å‹](/agentsdk/images/middleware-onion.svg)

### æ´‹è‘±æ¨¡å‹

```
Request â†’ M1 â†’ M2 â†’ M3 â†’ Handler â†’ M3 â†’ M2 â†’ M1 â†’ Response
          â†“    â†“    â†“              â†‘    â†‘    â†‘
      Before Before Before       After After After
```

### Middlewareæ¥å£

```go
type Middleware interface {
    // åŸºç¡€ä¿¡æ¯
    Name() string
    Priority() int  // 0-100: ç³»ç»Ÿ, 100-500: åŠŸèƒ½, 500+: ç”¨æˆ·

    // æä¾›å·¥å…·
    Tools() []tools.Tool

    // åŒå‘æ‹¦æˆª
    WrapModelCall(ctx, req, handler) (*ModelResponse, error)
    WrapToolCall(ctx, req, handler) (*ToolCallResponse, error)

    // ç”Ÿå‘½å‘¨æœŸ
    OnAgentStart(ctx, agentID) error
    OnAgentStop(ctx, agentID) error
}
```

### å†…ç½®ä¸­é—´ä»¶

#### 1. SummarizationMiddleware

**åŠŸèƒ½**ï¼šè‡ªåŠ¨ç®¡ç†ä¸Šä¸‹æ–‡é•¿åº¦

- **ä¼˜å…ˆçº§**ï¼š40
- **è§¦å‘æ¡ä»¶**ï¼šæ¶ˆæ¯å†å²è¶…è¿‡170k tokens
- **å¤„ç†æ–¹å¼**ï¼š
  1. ä¿ç•™æœ€è¿‘6æ¡æ¶ˆæ¯
  2. æ€»ç»“æ›´æ—©çš„æ¶ˆæ¯
  3. ç”¨æ€»ç»“æ›¿æ¢æ—§å†å²

```go
// å¯ç”¨è‡ªåŠ¨æ€»ç»“
config := &types.AgentConfig{
    Middlewares: []string{"summarization"},
}
```

#### 2. FilesystemMiddleware

**åŠŸèƒ½**ï¼šæä¾›æ–‡ä»¶ç³»ç»Ÿæ“ä½œå·¥å…·

- **ä¼˜å…ˆçº§**ï¼š100
- **å·¥å…·**ï¼š`fs_read`, `fs_write`, `fs_edit`, `fs_ls`, `fs_glob`, `fs_grep`
- **ç‰¹æ€§**ï¼š
  - è‡ªåŠ¨é©±é€å¤§ç»“æœï¼ˆ>20k tokensï¼‰
  - ç³»ç»Ÿæç¤ºè¯å¢å¼º
  - BackendæŠ½è±¡æ”¯æŒ

```go
fsMiddleware := middleware.NewFilesystemMiddleware(&middleware.FilesystemMiddlewareConfig{
    Backend:        backend,
    EnableEviction: true,
    TokenLimit:     20000,
})
```

#### 3. SubAgentMiddleware

**åŠŸèƒ½**ï¼šä»»åŠ¡å§”æ´¾åˆ°å­Agent

- **ä¼˜å…ˆçº§**ï¼š200
- **å·¥å…·**ï¼š`task`
- **ç‰¹æ€§**ï¼š
  - ä¸Šä¸‹æ–‡éš”ç¦»
  - å¹¶å‘æ‰§è¡Œæ”¯æŒ
  - å¯é…ç½®å­Agentè§„æ ¼

```go
subagentMiddleware := middleware.NewSubAgentMiddleware(&middleware.SubAgentMiddlewareConfig{
    Specs: []middleware.SubAgentSpec{
        {Name: "researcher", Description: "Research expert"},
        {Name: "coder", Description: "Coding expert"},
    },
    Factory:        subagentFactory,
    EnableParallel: true,
})
```

### ä¸­é—´ä»¶æ ˆç®¡ç†

```go
// åˆ›å»ºæ ˆï¼ˆè‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
stack := middleware.NewStack([]middleware.Middleware{
    fsMiddleware,       // priority: 100
    subagentMiddleware, // priority: 200
    customMiddleware,   // priority: 500
})

// è·å–æ‰€æœ‰å·¥å…·
tools := stack.Tools()

// æ‰§è¡Œæ¨¡å‹è°ƒç”¨ï¼ˆç»è¿‡æ‰€æœ‰ä¸­é—´ä»¶ï¼‰
response := stack.WrapModelCall(ctx, request, finalHandler)
```

## ğŸ—„ï¸ BackendæŠ½è±¡å±‚

Backendæä¾›ç»Ÿä¸€çš„å­˜å‚¨æ¥å£ï¼Œæ”¯æŒå¤šç§å®ç°ã€‚

### BackendProtocolæ¥å£

```go
type BackendProtocol interface {
    // æ–‡ä»¶æ“ä½œ
    Read(ctx, path, offset, limit) (string, error)
    Write(ctx, path, content) (*WriteResult, error)
    Edit(ctx, path, old, new, replaceAll) (*EditResult, error)

    // ç›®å½•æ“ä½œ
    ListInfo(ctx, path) ([]FileInfo, error)
    GlobInfo(ctx, pattern, path) ([]FileInfo, error)

    // æœç´¢
    GrepRaw(ctx, pattern, path, glob) ([]GrepMatch, error)
}
```

### å››ç§Backendå®ç°

| Backend | ç”Ÿå‘½å‘¨æœŸ | ä½¿ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|---------|---------|---------|------|
| **StateBackend** | ä¼šè¯çº§ | ä¸´æ—¶æ–‡ä»¶ã€ä¸­é—´ç»“æœ | å†…å­˜å­˜å‚¨ï¼Œå¿«é€Ÿ |
| **StoreBackend** | è·¨ä¼šè¯ | çŸ¥è¯†åº“ã€è®°å¿† | æŒä¹…åŒ–ï¼Œå¯æ¢å¤ |
| **FilesystemBackend** | æ°¸ä¹… | å·¥ä½œç©ºé—´æ–‡ä»¶ | çœŸå®æ–‡ä»¶ç³»ç»Ÿ |
| **CompositeBackend** | - | æ··åˆå­˜å‚¨ç­–ç•¥ | è·¯ç”±ç»„åˆ |

### ä½¿ç”¨ç¤ºä¾‹

#### å•ä¸€Backend

```go
// å†…å­˜ä¸´æ—¶å­˜å‚¨
backend := backends.NewStateBackend()
backend.Write(ctx, "/temp.txt", "content")

// æŒä¹…åŒ–å­˜å‚¨
storeBackend := backends.NewStoreBackend(storeImpl, "agent-id")
storeBackend.Write(ctx, "/memory.txt", "persistent data")

// çœŸå®æ–‡ä»¶ç³»ç»Ÿ
fsBackend := backends.NewFilesystemBackend(sandboxFS)
fsBackend.Write(ctx, "/workspace/output.txt", "result")
```

#### ç»„åˆBackend

```go
// è·¯ç”±ç­–ç•¥ï¼šä¸åŒè·¯å¾„ä½¿ç”¨ä¸åŒåç«¯
composite := backends.NewCompositeBackend(
    backends.NewStateBackend(), // é»˜è®¤åç«¯
    []backends.RouteConfig{
        {Prefix: "/memories/", Backend: storeBackend},
        {Prefix: "/workspace/", Backend: fsBackend},
    },
)

// /memories/* â†’ æŒä¹…åŒ–å­˜å‚¨
composite.Write(ctx, "/memories/user_profile.json", data)

// /workspace/* â†’ çœŸå®æ–‡ä»¶ç³»ç»Ÿ
composite.Write(ctx, "/workspace/output.py", code)

// å…¶ä»–è·¯å¾„ â†’ å†…å­˜ä¸´æ—¶å­˜å‚¨
composite.Write(ctx, "/temp/cache.txt", temp)
```

## ğŸ¯ äº‹ä»¶é©±åŠ¨æ¶æ„

AgentSDKé‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œé€šè¿‡ä¸‰ä¸ªç‹¬ç«‹é€šé“åˆ†ç¦»ä¸åŒç±»å‹çš„äº‹ä»¶ã€‚

### ä¸‰é€šé“è®¾è®¡

| é€šé“ | ç”¨é€” | å…¸å‹è®¢é˜…è€… | äº‹ä»¶ç±»å‹ |
|------|------|-----------|---------|
| **Progress** | å®æ—¶è¿›åº¦ã€UIå±•ç¤º | å‰ç«¯ã€èŠå¤©ç•Œé¢ | æ–‡æœ¬æµã€å·¥å…·æ‰§è¡Œ |
| **Control** | å®¡æ‰¹ã€äººæœºäº¤äº’ | å®¡æ‰¹æœåŠ¡ã€å®‰å…¨ç½‘å…³ | å·¥å…·å®¡æ‰¹è¯·æ±‚ |
| **Monitor** | ç›‘æ§ã€å®¡è®¡ | ç›‘æ§ç³»ç»Ÿã€æ—¥å¿—å¹³å° | é”™è¯¯ã€æ€§èƒ½æŒ‡æ ‡ |

### äº‹ä»¶è®¢é˜…

```go
// è®¢é˜…Progressé€šé“
progressCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelProgress,
}, nil)

for envelope := range progressCh {
    switch e := envelope.Event.(type) {
    case *types.ProgressTextChunkEvent:
        fmt.Print(e.Delta)  // æµå¼è¾“å‡º
    case *types.ProgressToolStartEvent:
        fmt.Printf("[Tool] %s\n", e.Call.Name)
    case *types.ProgressToolEndEvent:
        fmt.Printf("[Result] %v\n", e.Result)
    }
}
```

### äº‹ä»¶è¿‡æ»¤

```go
// åªè®¢é˜…ç‰¹å®šäº‹ä»¶ç±»å‹
eventCh := ag.Subscribe(
    []types.AgentChannel{types.ChannelProgress},
    &types.EventFilter{
        EventTypes: []string{
            "progress.text_chunk",
            "progress.tool_start",
        },
    },
)
```

## ğŸ› ï¸ å·¥å…·ç³»ç»Ÿ

### å·¥å…·æ¥å£

```go
type Tool interface {
    Name() string
    Description() string
    InputSchema() map[string]interface{}
    Execute(ctx context.Context, input map[string]interface{}) (interface{}, error)
}
```

### å·¥å…·æ³¨å†Œ

```go
// åˆ›å»ºæ³¨å†Œè¡¨
registry := tools.NewRegistry()

// æ³¨å†Œæ‰€æœ‰å†…ç½®å·¥å…·
builtin.RegisterAll(registry)

// æˆ–é€‰æ‹©æ€§æ³¨å†Œ
registry.Register(builtin.NewFileSystemTool())
registry.Register(builtin.NewBashTool())

// æ³¨å†Œè‡ªå®šä¹‰å·¥å…·
registry.Register(&MyCustomTool{})
```

### å·¥å…·åˆ†ç±»

#### æ–‡ä»¶ç³»ç»Ÿå·¥å…·

- `fs_read`ï¼šè¯»å–æ–‡ä»¶ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- `fs_write`ï¼šå†™å…¥æ–‡ä»¶
- `fs_edit`ï¼šç²¾ç¡®ç¼–è¾‘ï¼ˆå­—ç¬¦ä¸²æ›¿æ¢ï¼‰
- `fs_ls`ï¼šåˆ—å‡ºç›®å½•
- `fs_glob`ï¼šGlobæ¨¡å¼åŒ¹é…
- `fs_grep`ï¼šæ­£åˆ™æœç´¢

#### å‘½ä»¤æ‰§è¡Œå·¥å…·

- `bash_run`ï¼šæ‰§è¡ŒBashå‘½ä»¤

#### ä»»åŠ¡ç®¡ç†å·¥å…·

- `todo_list`ï¼šåˆ—å‡ºå¾…åŠäº‹é¡¹
- `todo_add`ï¼šæ·»åŠ å¾…åŠ
- `todo_update`ï¼šæ›´æ–°å¾…åŠçŠ¶æ€

#### ç½‘ç»œå·¥å…·

- `http_fetch`ï¼šHTTPè¯·æ±‚
- `web_search`ï¼šç½‘ç»œæœç´¢

#### å­Agentå·¥å…·

- `task`ï¼šä»»åŠ¡å§”æ´¾

## ğŸ­ Providerç³»ç»Ÿ

### Provideræ¥å£

```go
type Provider interface {
    // æµå¼API
    StreamMessages(ctx, request) (<-chan StreamEvent, error)

    // éæµå¼API
    Messages(ctx, request) (*Response, error)

    // æ¨¡å‹ä¿¡æ¯
    Name() string
    SupportedModels() []string
}
```

### æ”¯æŒçš„Provider

| Provider | æ¨¡å‹ | ç‰¹ç‚¹ |
|---------|------|------|
| **Anthropic** | Claude 3/4ç³»åˆ— | é•¿ä¸Šä¸‹æ–‡ã€å·¥å…·è°ƒç”¨ä¼˜ç§€ |
| **OpenAI** | GPT-4/GPT-3.5 | ç”Ÿæ€æˆç†Ÿ |
| **DeepSeek** | DeepSeek-V2 | æ€§ä»·æ¯”é«˜ |
| **GLM** | ChatGLMç³»åˆ— | ä¸­æ–‡ä¼˜åŒ– |

### ä½¿ç”¨ç¤ºä¾‹

```go
// Anthropic
p := provider.NewAnthropicProvider(apiKey)

// OpenAI
p := provider.NewOpenAIProvider(apiKey)

// DeepSeek
p := provider.NewDeepSeekProvider(apiKey)

// ç»Ÿä¸€æ¥å£è°ƒç”¨
stream, _ := p.StreamMessages(ctx, request)
for event := range stream {
    // å¤„ç†æµå¼äº‹ä»¶
}
```

## ğŸ”’ æ²™ç®±ç³»ç»Ÿ

### æ²™ç®±ç±»å‹

| ç±»å‹ | ä½¿ç”¨åœºæ™¯ | éš”ç¦»çº§åˆ« | é…ç½® |
|-----|---------|---------|------|
| **LocalSandbox** | å¼€å‘æµ‹è¯• | è¿›ç¨‹çº§ | æœ¬åœ°Docker |
| **AliyunSandbox** | ç”Ÿäº§ç¯å¢ƒ | å®¹å™¨çº§ | AgentBay |
| **VolcengineSandbox** | ç”Ÿäº§ç¯å¢ƒ | å®¹å™¨çº§ | ç«å±±å¼•æ“ |
| **MockSandbox** | å•å…ƒæµ‹è¯• | æ— éš”ç¦» | æ¨¡æ‹Ÿæ‰§è¡Œ |

### é…ç½®ç¤ºä¾‹

```go
// æœ¬åœ°æ²™ç®±
Sandbox: &types.SandboxConfig{
    Kind:    types.SandboxKindLocal,
    WorkDir: "./workspace",
}

// é˜¿é‡Œäº‘æ²™ç®±
Sandbox: &types.SandboxConfig{
    Kind:    types.SandboxKindAliyun,
    WorkDir: "/workspace",
    Config: map[string]interface{}{
        "region":    "cn-hangzhou",
        "accessKey": os.Getenv("ALIYUN_AK"),
        "secretKey": os.Getenv("ALIYUN_SK"),
    },
}
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

åŸºäºApple M1, Go 1.21çš„æ€§èƒ½æµ‹è¯•ï¼š

| æ“ä½œ | æ€§èƒ½ | å†…å­˜åˆ†é… | ååé‡ |
|------|------|---------|--------|
| Middleware Stack | 36.21 ns/op | 96 B/op | ~27M ops/s |
| Backend Write | 257.9 ns/op | 480 B/op | ~3.8M ops/s |
| Tool Execution | < 1ms | 1-5 KB | 1000+ ops/s |

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. Protocol + Factoryæ¨¡å¼

```go
// å®šä¹‰åè®®
type BackendProtocol interface { ... }

// å·¥å‚å‡½æ•°
type BackendFactory func(ctx) (BackendProtocol, error)

// å»¶è¿Ÿåˆå§‹åŒ–
backend := factory(ctx)
```

### 2. æ´‹è‘±æ¨¡å‹

```go
type Middleware interface {
    WrapModelCall(ctx, req, next) (*Response, error)
}

// è‡ªåŠ¨ç»„åˆ
stack.WrapModelCall(ctx, req, finalHandler)
```

### 3. è§‚å¯Ÿè€…æ¨¡å¼

```go
// è®¢é˜…äº‹ä»¶
ch := ag.Subscribe(channels, filter)

// å‘å¸ƒäº‹ä»¶
ag.Emit(event)
```

## ğŸ”„ ä¸DeepAgentså¯¹æ¯”

| ç‰¹æ€§ | DeepAgents (Python) | AgentSDK (Go) |
|------|-------------------|---------------|
| Backend Protocol | âœ… 4ç§ | âœ… 4ç§ |
| Middlewareæ ˆ | âœ… æ´‹è‘±æ¨¡å‹ | âœ… æ´‹è‘±æ¨¡å‹ |
| æ–‡ä»¶å·¥å…· | âœ… 6ä¸ª | âœ… 6ä¸ª |
| è‡ªåŠ¨é©±é€ | âœ… | âœ… |
| å­ä»£ç† | âœ… | âœ… |
| æ€§èƒ½ | ä¸­ç­‰ | **æé«˜** |
| å†…å­˜ | é«˜ | **ä½** |
| å¹¶å‘ | GILé™åˆ¶ | **çœŸæ­£å¹¶å‘** |
| ç±»å‹å®‰å…¨ | åŠ¨æ€ | **é™æ€** |

## ğŸ“š ä¸‹ä¸€æ­¥

- [Agentç”Ÿå‘½å‘¨æœŸ](/core-concepts/agent-lifecycle) - ç†è§£Agentè¿è¡Œæ—¶
- [ä¸­é—´ä»¶å¼€å‘](/core-concepts/middleware) - åˆ›å»ºè‡ªå®šä¹‰ä¸­é—´ä»¶
- [å®æˆ˜æŒ‡å—](/guides/basic-agent) - å®Œæ•´é¡¹ç›®ç¤ºä¾‹
- [APIå‚è€ƒ](/api-reference/agent-api) - è¯¦ç»†APIæ–‡æ¡£

## ğŸ”— ç›¸å…³èµ„æº

- [DeepAgents](https://github.com/anthropics/deepagents) - Pythonå‚è€ƒå®ç°
- [ç¤ºä¾‹ä»£ç ](https://github.com/wordflowlab/agentsdk/tree/main/examples)
- [Phase 6Cæ–‡æ¡£](https://github.com/wordflowlab/agentsdk/blob/main/docs/PHASE6C_MIDDLEWARE_INTEGRATION.md)
