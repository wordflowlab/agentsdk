---
title: å¿«é€Ÿå¼€å§‹
description: 5åˆ†é’Ÿåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªAgentSDKåº”ç”¨
---

# å¿«é€Ÿå¼€å§‹

æœ¬æŒ‡å—å°†å¸¦æ‚¨åœ¨5åˆ†é’Ÿå†…åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„AI Agentã€‚

## ğŸš€ å‰ç½®å‡†å¤‡

ç¡®ä¿å·²å®Œæˆï¼š

1. âœ… å®‰è£…Go 1.21+
2. âœ… è·å–APIå¯†é’¥ï¼ˆ[Anthropic](https://console.anthropic.com/)ï¼‰
3. âœ… å®‰è£…AgentSDKï¼š`go get github.com/wordflowlab/agentsdk`

## ğŸ“ ç¬¬ä¸€ä¸ªAgent

### æ­¥éª¤1ï¼šåˆ›å»ºé¡¹ç›®

```bash
mkdir my-first-agent
cd my-first-agent
go mod init my-first-agent
go get github.com/wordflowlab/agentsdk
```

### æ­¥éª¤2ï¼šç¼–å†™ä»£ç 

åˆ›å»º `main.go`ï¼š

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"

    "github.com/wordflowlab/agentsdk/pkg/agent"
    "github.com/wordflowlab/agentsdk/pkg/provider"
    "github.com/wordflowlab/agentsdk/pkg/sandbox"
    "github.com/wordflowlab/agentsdk/pkg/store"
    "github.com/wordflowlab/agentsdk/pkg/tools"
    "github.com/wordflowlab/agentsdk/pkg/tools/builtin"
    "github.com/wordflowlab/agentsdk/pkg/types"
)

func main() {
    // 1. åˆ›å»ºå·¥å…·æ³¨å†Œè¡¨å¹¶æ³¨å†Œå†…ç½®å·¥å…·
    toolRegistry := tools.NewRegistry()
    builtin.RegisterAll(toolRegistry)

    // 2. åˆ›å»ºä¾èµ–
    jsonStore, _ := store.NewJSONStore("./.agentsdk")
    deps := &agent.Dependencies{
        Store:            jsonStore,
        SandboxFactory:   sandbox.NewFactory(),
        ToolRegistry:     toolRegistry,
        ProviderFactory:  &provider.AnthropicFactory{},
        TemplateRegistry: agent.NewTemplateRegistry(),
    }

    // 3. æ³¨å†ŒAgentæ¨¡æ¿
    deps.TemplateRegistry.Register(&types.AgentTemplateDefinition{
        ID:           "assistant",
        SystemPrompt: "You are a helpful assistant with file and bash access.",
        Model:        "claude-sonnet-4-5",
        Tools:        []interface{}{"fs_read", "fs_write", "bash_run"},
    })

    // 4. åˆ›å»ºAgent
    ag, err := agent.Create(context.Background(), &types.AgentConfig{
        TemplateID: "assistant",
        ModelConfig: &types.ModelConfig{
            Provider: "anthropic",
            Model:    "claude-sonnet-4-5",
            APIKey:   os.Getenv("ANTHROPIC_API_KEY"),
        },
        Sandbox: &types.SandboxConfig{
            Kind:    types.SandboxKindLocal,
            WorkDir: "./workspace",
        },
    }, deps)
    if err != nil {
        log.Fatal(err)
    }
    defer ag.Close()

    // 5. è®¢é˜…äº‹ä»¶å¹¶å®æ—¶è¾“å‡º
    eventCh := ag.Subscribe([]types.AgentChannel{types.ChannelProgress}, nil)
    go func() {
        for envelope := range eventCh {
            if evt, ok := envelope.Event.(types.EventType); ok {
                switch e := evt.(type) {
                case *types.ProgressTextChunkEvent:
                    fmt.Print(e.Delta) // å®æ—¶è¾“å‡ºAIå›å¤
                case *types.ProgressToolStartEvent:
                    fmt.Printf("\n[Tool] %s\n", e.Call.Name)
                }
            }
        }
    }()

    // 6. åŒæ­¥å¯¹è¯
    result, err := ag.Chat(context.Background(),
        "è¯·åˆ›å»ºä¸€ä¸ª hello.txt æ–‡ä»¶ï¼Œå†…å®¹æ˜¯ 'Hello AgentSDK!'")
    if err != nil {
        log.Fatal(err)
    }
    fmt.Printf("\n\nâœ… å®Œæˆ: %s\n", result.Text)
}
```

### æ­¥éª¤3ï¼šè®¾ç½®APIå¯†é’¥

```bash
export ANTHROPIC_API_KEY="sk-ant-xxxxx"
```

### æ­¥éª¤4ï¼šè¿è¡Œ

```bash
go run main.go
```

**é¢„æœŸè¾“å‡º**ï¼š

```
[Tool] fs_write

æˆ‘å·²ç»åˆ›å»ºäº† hello.txt æ–‡ä»¶ï¼Œå†…å®¹ä¸º 'Hello AgentSDK!'

âœ… å®Œæˆ: æ–‡ä»¶åˆ›å»ºæˆåŠŸ
```

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µå¿«é€Ÿç†è§£

### 1. å·¥å…·æ³¨å†Œè¡¨ï¼ˆToolRegistryï¼‰

ç®¡ç†æ‰€æœ‰å¯ç”¨å·¥å…·ï¼š

```go
toolRegistry := tools.NewRegistry()

// æ³¨å†Œæ‰€æœ‰å†…ç½®å·¥å…·
builtin.RegisterAll(toolRegistry)

// æˆ–é€‰æ‹©æ€§æ³¨å†Œ
toolRegistry.Register(builtin.NewFileSystemTool())
toolRegistry.Register(builtin.NewBashTool())
```

### 2. Agentæ¨¡æ¿ï¼ˆTemplateï¼‰

é¢„å®šä¹‰Agenté…ç½®ï¼Œä¾¿äºå¤ç”¨ï¼š

```go
deps.TemplateRegistry.Register(&types.AgentTemplateDefinition{
    ID:           "coder",
    SystemPrompt: "You are an expert programmer.",
    Model:        "claude-sonnet-4-5",
    Tools:        []interface{}{"fs_*", "bash_run", "fs_grep"},
})

// ä½¿ç”¨æ¨¡æ¿åˆ›å»ºAgent
ag, _ := agent.Create(ctx, &types.AgentConfig{
    TemplateID: "coder",
}, deps)
```

### 3. äº‹ä»¶é€šé“ï¼ˆChannelsï¼‰

ä¸‰ç§äº‹ä»¶é€šé“åˆ†ç¦»å…³æ³¨ç‚¹ï¼š

```go
// Progress: UIå±•ç¤º
eventCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelProgress,  // æµå¼æ–‡æœ¬ã€å·¥å…·æ‰§è¡Œ
}, nil)

// Monitor: ç›‘æ§å‘Šè­¦
monitorCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelMonitor,   // é”™è¯¯ã€å®¡è®¡æ—¥å¿—
}, nil)

// Control: äººæœºäº¤äº’
controlCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelControl,   // å·¥å…·å®¡æ‰¹è¯·æ±‚
}, nil)
```

### 4. æ²™ç®±é…ç½®ï¼ˆSandboxï¼‰

å®‰å…¨æ‰§è¡Œä»£ç ï¼š

```go
// æœ¬åœ°æ²™ç®±ï¼ˆå¼€å‘ï¼‰
Sandbox: &types.SandboxConfig{
    Kind:    types.SandboxKindLocal,
    WorkDir: "./workspace",
}

// é˜¿é‡Œäº‘æ²™ç®±ï¼ˆç”Ÿäº§ï¼‰
Sandbox: &types.SandboxConfig{
    Kind:    types.SandboxKindAliyun,
    WorkDir: "/workspace",
}
```

## ğŸ› ï¸ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ–‡ä»¶å¤„ç†Agent

```go
// æ¨¡æ¿ï¼šæ–‡ä»¶åŠ©æ‰‹
deps.TemplateRegistry.Register(&types.AgentTemplateDefinition{
    ID:           "file-helper",
    SystemPrompt: "You are a file processing expert.",
    Tools: []interface{}{
        "fs_read", "fs_write", "fs_edit",
        "fs_ls", "fs_glob", "fs_grep",
    },
})

// ä½¿ç”¨
ag, _ := agent.Create(ctx, &types.AgentConfig{
    TemplateID: "file-helper",
}, deps)

ag.Chat(ctx, "åˆ—å‡ºæ‰€æœ‰.goæ–‡ä»¶å¹¶ç»Ÿè®¡è¡Œæ•°")
```

### åœºæ™¯2ï¼šä»£ç æ‰§è¡ŒAgent

```go
// æ¨¡æ¿ï¼šä»£ç æ‰§è¡Œå™¨
deps.TemplateRegistry.Register(&types.AgentTemplateDefinition{
    ID:           "executor",
    SystemPrompt: "You can execute bash commands safely.",
    Tools:        []interface{}{"bash_run", "fs_read"},
})

// ä½¿ç”¨
ag, _ := agent.Create(ctx, &types.AgentConfig{
    TemplateID: "executor",
    Sandbox: &types.SandboxConfig{
        Kind: types.SandboxKindLocal,
    },
}, deps)

ag.Chat(ctx, "è¿è¡Œ go test ./... å¹¶æ˜¾ç¤ºç»“æœ")
```

### åœºæ™¯3ï¼šå¯ç”¨ä¸­é—´ä»¶

```go
// åˆ›å»ºAgentæ—¶å¯ç”¨ä¸­é—´ä»¶
ag, _ := agent.Create(ctx, &types.AgentConfig{
    TemplateID: "assistant",
    Middlewares: []string{
        "filesystem",     // æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
        "summarization",  // è‡ªåŠ¨ä¸Šä¸‹æ–‡æ€»ç»“
    },
}, deps)

// ä¸­é—´ä»¶ä¼šè‡ªåŠ¨ï¼š
// 1. æä¾›é¢å¤–å·¥å…·ï¼ˆå¦‚ fs_* å·¥å…·ï¼‰
// 2. ç®¡ç†ä¸Šä¸‹æ–‡ï¼ˆè‡ªåŠ¨æ€»ç»“é•¿å¯¹è¯ï¼‰
// 3. æ‹¦æˆªå’Œå¢å¼ºè°ƒç”¨
```

## ğŸ“š å†…ç½®å·¥å…·åˆ—è¡¨

AgentSDKæä¾›ä¸°å¯Œçš„å†…ç½®å·¥å…·ï¼š

| ç±»åˆ« | å·¥å…·åç§° | åŠŸèƒ½æè¿° |
|------|---------|---------|
| **æ–‡ä»¶ç³»ç»Ÿ** | `fs_read` | è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆæ”¯æŒåˆ†é¡µï¼‰ |
| | `fs_write` | å†™å…¥æ–‡ä»¶ |
| | `fs_edit` | ç²¾ç¡®ç¼–è¾‘ï¼ˆå­—ç¬¦ä¸²æ›¿æ¢ï¼‰ |
| | `fs_ls` | åˆ—å‡ºç›®å½• |
| | `fs_glob` | Globæ¨¡å¼åŒ¹é… |
| | `fs_grep` | æ­£åˆ™æœç´¢ï¼ˆæ˜¾ç¤ºè¡Œå·ï¼‰ |
| **å‘½ä»¤æ‰§è¡Œ** | `bash_run` | æ‰§è¡ŒBashå‘½ä»¤ |
| **ä»»åŠ¡ç®¡ç†** | `todo_list` | åˆ—å‡ºå¾…åŠäº‹é¡¹ |
| | `todo_add` | æ·»åŠ å¾…åŠ |
| | `todo_update` | æ›´æ–°å¾…åŠçŠ¶æ€ |
| **ç½‘ç»œ** | `http_fetch` | HTTPè¯·æ±‚ |
| | `web_search` | ç½‘ç»œæœç´¢ |

**æ³¨å†Œæ‰€æœ‰å·¥å…·**ï¼š

```go
builtin.RegisterAll(toolRegistry)
```

**é€‰æ‹©æ€§æ³¨å†Œ**ï¼š

```go
toolRegistry.Register(builtin.NewFileSystemTool())
toolRegistry.Register(builtin.NewBashTool())
```

## ğŸ”„ å¼‚æ­¥vsåŒæ­¥

### å¼‚æ­¥ï¼šè®¢é˜…äº‹ä»¶

```go
// å¯åŠ¨å¯¹è¯ï¼ˆéé˜»å¡ï¼‰
eventCh := ag.Subscribe([]types.AgentChannel{types.ChannelProgress}, nil)
ag.Send(ctx, "ä½ å¥½")

// å¤„ç†äº‹ä»¶æµ
for envelope := range eventCh {
    // å¤„ç†äº‹ä»¶
}
```

### åŒæ­¥ï¼šç­‰å¾…ç»“æœ

```go
// é˜»å¡ç­‰å¾…å®Œæˆ
result, err := ag.Chat(ctx, "ä½ å¥½")
if err != nil {
    log.Fatal(err)
}
fmt.Println(result.Text)
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. æµå¼å¤„ç†

ä¼˜å…ˆä½¿ç”¨å¼‚æ­¥è®¢é˜…æ–¹å¼ï¼š

```go
// âœ… æ¨èï¼šæµå¼å¤„ç†
eventCh := ag.Subscribe([]types.AgentChannel{types.ChannelProgress}, nil)
go func() {
    for envelope := range eventCh {
        // å®æ—¶å¤„ç†
    }
}()

// âŒ ä¸æ¨èï¼šé˜»å¡ç­‰å¾…
result, _ := ag.Chat(ctx, message)  // ç­‰å¾…å®Œæ•´å“åº”
```

### 2. å¹¶å‘Agent

```go
// åˆ›å»ºå¤šä¸ªAgentå¹¶å‘å¤„ç†
agents := make([]*agent.Agent, 5)
for i := range agents {
    agents[i], _ = agent.Create(ctx, config, deps)
}

// å¹¶å‘å‘é€ä»»åŠ¡
var wg sync.WaitGroup
for i, ag := range agents {
    wg.Add(1)
    go func(a *agent.Agent, taskID int) {
        defer wg.Done()
        a.Chat(ctx, fmt.Sprintf("ä»»åŠ¡ %d", taskID))
    }(ag, i)
}
wg.Wait()
```

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨Monitoré€šé“

```go
monitorCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelProgress,
    types.ChannelMonitor,  // ç›‘æ§äº‹ä»¶
}, nil)

for envelope := range monitorCh {
    switch e := envelope.Event.(type) {
    case *types.MonitorErrorEvent:
        log.Printf("é”™è¯¯: %v", e.Error)
    case *types.MonitorToolExecutionEvent:
        log.Printf("å·¥å…·: %s è€—æ—¶: %v", e.ToolName, e.Duration)
    }
}
```

### 2. æ‰“å°å·¥å…·è°ƒç”¨

```go
case *types.ProgressToolStartEvent:
    fmt.Printf("[Tool Start] %s(%v)\n", e.Call.Name, e.Call.Input)
case *types.ProgressToolEndEvent:
    fmt.Printf("[Tool End] %s -> %v\n", e.Call.Name, e.Result)
```

## ğŸš€ ä¸‹ä¸€æ­¥

- [æ ¸å¿ƒæ¦‚å¿µ](/core-concepts/agent-lifecycle) - æ·±å…¥ç†è§£Agentç”Ÿå‘½å‘¨æœŸ
- [ä¸­é—´ä»¶ç³»ç»Ÿ](/core-concepts/middleware) - å­¦ä¹ æ´‹è‘±æ¨¡å‹
- [å®æˆ˜æŒ‡å—](/guides/basic-agent) - å®Œæ•´é¡¹ç›®ç¤ºä¾‹
- [APIå‚è€ƒ](/api-reference/agent-api) - è¯¦ç»†APIæ–‡æ¡£

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åˆ‡æ¢æ¨¡å‹ï¼Ÿ

```go
ModelConfig: &types.ModelConfig{
    Provider: "openai",        // æ”¹ä¸ºopenai
    Model:    "gpt-4-turbo",   // æ”¹ä¸ºgpt-4
    APIKey:   os.Getenv("OPENAI_API_KEY"),
}
```

### Q2: å¦‚ä½•é™åˆ¶å·¥å…·ä½¿ç”¨ï¼Ÿ

```go
// åªå…è®¸ç‰¹å®šå·¥å…·
Tools: []interface{}{"fs_read", "fs_write"}  // ä¸åŒ…å«bash_run

// æˆ–ä½¿ç”¨æƒé™ç³»ç»Ÿ
// å‚è§ï¼š/guides/permission-control
```

### Q3: å¦‚ä½•å¤„ç†é•¿å¯¹è¯ï¼Ÿ

```go
// å¯ç”¨è‡ªåŠ¨æ€»ç»“ä¸­é—´ä»¶
Middlewares: []string{"summarization"}

// å½“ä¸Šä¸‹æ–‡è¶…è¿‡170k tokensæ—¶è‡ªåŠ¨æ€»ç»“
```

### Q4: å¦‚ä½•è‡ªå®šä¹‰å·¥å…·ï¼Ÿ

```go
// å®ç°Toolæ¥å£
type MyTool struct{}

func (t *MyTool) Name() string { return "my_tool" }
func (t *MyTool) Description() string { return "My custom tool" }
func (t *MyTool) InputSchema() map[string]interface{} {
    return map[string]interface{}{
        "type": "object",
        "properties": map[string]interface{}{
            "input": map[string]string{"type": "string"},
        },
    }
}
func (t *MyTool) Execute(ctx context.Context, input map[string]interface{}) (interface{}, error) {
    // ä½ çš„é€»è¾‘
    return "ç»“æœ", nil
}

// æ³¨å†Œ
toolRegistry.Register(&MyTool{})
```

## ğŸŒŠ å·¥ä½œæµ Agent

### åœºæ™¯5ï¼šé¡ºåºå·¥ä½œæµ

```go
import "github.com/wordflowlab/agentsdk/pkg/agent/workflow"

// åˆ›å»ºé¡ºåºå·¥ä½œæµï¼ˆæ•°æ®æ”¶é›† â†’ åˆ†æ â†’ æŠ¥å‘Šï¼‰
sequential, _ := workflow.NewSequentialAgent(workflow.SequentialConfig{
    Name: "DataPipeline",
    SubAgents: []workflow.Agent{
        NewDataCollectorAgent(),
        NewAnalyzerAgent(),
        NewReporterAgent(),
    },
})

// æ‰§è¡Œå·¥ä½œæµ
for event, err := range sequential.Execute(ctx, "å¤„ç†ç”¨æˆ·æ•°æ®") {
    fmt.Printf("æ­¥éª¤ %d/%d: %s\n",
        event.Metadata["sequential_step"],
        event.Metadata["total_steps"],
        event.Content.Content)
}
```

### åœºæ™¯6ï¼šå¹¶è¡Œæ‰§è¡Œ

```go
// åˆ›å»ºå¹¶è¡Œå·¥ä½œæµï¼ˆåŒæ—¶è¿è¡Œå¤šä¸ªç®—æ³•ï¼‰
parallel, _ := workflow.NewParallelAgent(workflow.ParallelConfig{
    Name: "MultiAlgorithm",
    SubAgents: []workflow.Agent{
        NewAlgorithmAgent("Fast"),
        NewAlgorithmAgent("Accurate"),
        NewAlgorithmAgent("Balanced"),
    },
})

// å¹¶å‘æ‰§è¡Œï¼Œæ”¶é›†æ‰€æœ‰ç»“æœ
for event, err := range parallel.Execute(ctx, "æ±‚è§£é—®é¢˜") {
    fmt.Printf("æ–¹æ¡ˆ %s: %s\n", event.AgentID, event.Content.Content)
}
```

### åœºæ™¯7ï¼šå¾ªç¯ä¼˜åŒ–

```go
// åˆ›å»ºå¾ªç¯å·¥ä½œæµï¼ˆè¿­ä»£ä¼˜åŒ–ç›´åˆ°è´¨é‡è¾¾æ ‡ï¼‰
loop, _ := workflow.NewLoopAgent(workflow.LoopConfig{
    Name:          "OptimizationLoop",
    SubAgents:     []workflow.Agent{critic, improver},
    MaxIterations: 5,
    StopCondition: func(event *session.Event) bool {
        // è´¨é‡è¾¾åˆ°90åˆ†æ—¶åœæ­¢
        return event.Metadata["quality_score"].(int) >= 90
    },
})

for event, _ := range loop.Execute(ctx, "ä¼˜åŒ–ä»£ç ") {
    fmt.Printf("è¿­ä»£ %d: %s\n",
        event.Metadata["loop_iteration"],
        event.Content.Content)
}
```

## ğŸ’¾ Session æŒä¹…åŒ–

### åœºæ™¯8ï¼šPostgreSQL æŒä¹…åŒ–

```go
import "github.com/wordflowlab/agentsdk/pkg/session/postgres"

// åˆ›å»º PostgreSQL Session æœåŠ¡
sessionService, _ := postgres.NewService(&postgres.Config{
    DSN: "host=localhost port=5432 user=postgres dbname=agentsdk",
    AutoMigrate: true,
})
defer sessionService.Close()

// åˆ›å»º Session
sess, _ := sessionService.Create(ctx, &session.CreateRequest{
    AppName: "my-app",
    UserID:  "user-001",
    AgentID: "agent-001",
})

// è¿½åŠ äº‹ä»¶
event := &session.Event{
    ID:      "evt-001",
    AgentID: "agent-001",
    Content: types.Message{Role: types.RoleUser, Content: "Hello"},
}
sessionService.AppendEvent(ctx, sess.ID, event)

// æŸ¥è¯¢äº‹ä»¶
events, _ := sessionService.GetEvents(ctx, sess.ID, nil)
fmt.Printf("æŸ¥è¯¢åˆ° %d ä¸ªäº‹ä»¶\n", len(events))
```

### åœºæ™¯9ï¼šMySQL æŒä¹…åŒ–

```go
import "github.com/wordflowlab/agentsdk/pkg/session/mysql"

// MySQL ä½¿ç”¨æ–¹å¼ä¸ PostgreSQL ç›¸åŒ
mysqlService, _ := mysql.NewService(&mysql.Config{
    DSN: "root:password@tcp(127.0.0.1:3306)/agentsdk?charset=utf8mb4",
    AutoMigrate: true,
})
// ä½¿ç”¨æ–¹å¼ä¸ PostgreSQL ç›¸åŒ
```

## ğŸ“– ç¤ºä¾‹ä»£ç 

æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ï¼š

- [åŸºç¡€Agent](https://github.com/wordflowlab/agentsdk/tree/main/examples/agent)
- [æ–‡ä»¶ç³»ç»Ÿæ“ä½œ](https://github.com/wordflowlab/agentsdk/tree/main/examples/filesystem)
- [å·¥ä½œæµAgent](https://github.com/wordflowlab/agentsdk/tree/main/examples/workflow-agents)
- [SessionæŒä¹…åŒ–](https://github.com/wordflowlab/agentsdk/tree/main/examples/session-postgres)
- [MCPé›†æˆ](https://github.com/wordflowlab/agentsdk/tree/main/examples/mcp)
- [å¤šAgentåä½œ](https://github.com/wordflowlab/agentsdk/tree/main/examples/multi-agent)
- [ä¸­é—´ä»¶ç³»ç»Ÿ](https://github.com/wordflowlab/agentsdk/tree/main/examples/middleware)
