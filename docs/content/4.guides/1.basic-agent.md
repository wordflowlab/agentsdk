---
title: åŸºç¡€Agentå¼€å‘
description: ä»é›¶å¼€å§‹åˆ›å»ºå®Œæ•´çš„Agentåº”ç”¨
---

# åŸºç¡€Agentå¼€å‘

æœ¬æŒ‡å—å°†å¸¦æ‚¨ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Agentåº”ç”¨ï¼Œæ¶µç›–é¡¹ç›®åˆå§‹åŒ–ã€ä¾èµ–é…ç½®ã€Agentåˆ›å»ºå’Œäº‹ä»¶å¤„ç†ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åŠ©æ‰‹Agentï¼Œèƒ½å¤Ÿï¼š
- è¯»å–å’Œå†™å…¥æ–‡ä»¶
- æ‰§è¡Œæœç´¢å’Œç¼–è¾‘æ“ä½œ
- æµå¼è¾“å‡ºå“åº”
- å¤„ç†é”™è¯¯å’Œå¼‚å¸¸

## ğŸ“ é¡¹ç›®ç»“æ„

```
file-assistant/
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ main.go
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â””â”€â”€ workspace/
```

## ğŸš€ æ­¥éª¤1ï¼šåˆå§‹åŒ–é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir file-assistant
cd file-assistant

# åˆå§‹åŒ–Goæ¨¡å—
go mod init file-assistant

# å®‰è£…ä¾èµ–
go get github.com/wordflowlab/agentsdk
go get github.com/joho/godotenv  # ç¯å¢ƒå˜é‡ç®¡ç†
```

## ğŸ“ æ­¥éª¤2ï¼šé…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# APIå¯†é’¥
ANTHROPIC_API_KEY=sk-ant-xxxxx

# å¯é€‰é…ç½®
AGENT_MODEL=claude-sonnet-4-5
WORKSPACE_DIR=./workspace
```

åˆ›å»º `.gitignore`ï¼š

```gitignore
.env
workspace/
.agentsdk/
```

## ğŸ’» æ­¥éª¤3ï¼šç¼–å†™ä¸»ç¨‹åº

åˆ›å»º `main.go`ï¼š

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"

    "github.com/joho/godotenv"
    "github.com/wordflowlab/agentsdk/pkg/agent"
    "github.com/wordflowlab/agentsdk/pkg/provider"
    "github.com/wordflowlab/agentsdk/pkg/sandbox"
    "github.com/wordflowlab/agentsdk/pkg/store"
    "github.com/wordflowlab/agentsdk/pkg/tools"
    "github.com/wordflowlab/agentsdk/pkg/tools/builtin"
    "github.com/wordflowlab/agentsdk/pkg/types"
)

func main() {
    // åŠ è½½ç¯å¢ƒå˜é‡
    if err := godotenv.Load(); err != nil {
        log.Println("æœªæ‰¾åˆ°.envæ–‡ä»¶ï¼Œä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡")
    }

    // åˆ›å»ºAgent
    ag, err := createAgent()
    if err != nil {
        log.Fatal(err)
    }
    defer ag.Close()

    // å¯åŠ¨äº‹ä»¶å¤„ç†
    go handleEvents(ag)

    // è¿è¡Œå¯¹è¯
    runConversation(ag)
}

func createAgent() (*agent.Agent, error) {
    ctx := context.Background()

    // 1. åˆ›å»ºå·¥å…·æ³¨å†Œè¡¨
    toolRegistry := tools.NewRegistry()
    builtin.RegisterAll(toolRegistry)

    // 2. åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨
    jsonStore, err := store.NewJSONStore("./.agentsdk")
    if err != nil {
        return nil, fmt.Errorf("åˆ›å»ºå­˜å‚¨å¤±è´¥: %w", err)
    }

    // 3. å‡†å¤‡ä¾èµ–
    deps := &agent.Dependencies{
        Store:            jsonStore,
        SandboxFactory:   sandbox.NewFactory(),
        ToolRegistry:     toolRegistry,
        ProviderFactory:  &provider.AnthropicFactory{},
        TemplateRegistry: agent.NewTemplateRegistry(),
    }

    // 4. æ³¨å†Œæ¨¡æ¿
    deps.TemplateRegistry.Register(&types.AgentTemplateDefinition{
        ID:           "file-assistant",
        SystemPrompt: "ä½ æ˜¯ä¸€ä¸ªæ–‡ä»¶åŠ©æ‰‹ï¼Œæ“…é•¿æ–‡ä»¶æ“ä½œå’Œå†…å®¹åˆ†æã€‚",
        Model:        getEnv("AGENT_MODEL", "claude-sonnet-4-5"),
        Tools: []interface{}{
            "fs_read", "fs_write", "fs_edit",
            "fs_ls", "fs_glob", "fs_grep",
        },
    })

    // 5. åˆ›å»ºAgent
    ag, err := agent.Create(ctx, &types.AgentConfig{
        TemplateID: "file-assistant",
        ModelConfig: &types.ModelConfig{
            Provider: "anthropic",
            Model:    getEnv("AGENT_MODEL", "claude-sonnet-4-5"),
            APIKey:   os.Getenv("ANTHROPIC_API_KEY"),
        },
        Sandbox: &types.SandboxConfig{
            Kind:    types.SandboxKindLocal,
            WorkDir: getEnv("WORKSPACE_DIR", "./workspace"),
        },
    }, deps)

    return ag, err
}

func handleEvents(ag *agent.Agent) {
    eventCh := ag.Subscribe([]types.AgentChannel{
        types.ChannelProgress,
        types.ChannelMonitor,
    }, nil)

    for envelope := range eventCh {
        switch e := envelope.Event.(type) {
        case *types.ProgressTextChunkEvent:
            fmt.Print(e.Delta)

        case *types.ProgressToolStartEvent:
            fmt.Printf("\n\nğŸ”§ [%s]\n", e.Call.Name)

        case *types.ProgressToolEndEvent:
            if e.Error != nil {
                fmt.Printf("   âŒ å¤±è´¥: %v\n\n", e.Error)
            } else {
                fmt.Printf("   âœ… å®Œæˆ\n\n")
            }

        case *types.MonitorErrorEvent:
            log.Printf("[ERROR] %v", e.Error)
        }
    }
}

func runConversation(ag *agent.Agent) {
    ctx := context.Background()

    // ç¤ºä¾‹å¯¹è¯
    queries := []string{
        "åˆ—å‡ºworkspaceç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶",
        "åˆ›å»ºä¸€ä¸ªhello.txtæ–‡ä»¶ï¼Œå†…å®¹æ˜¯'Hello AgentSDK'",
        "è¯»å–hello.txtçš„å†…å®¹",
        "åœ¨workspaceç›®å½•ä¸‹æœç´¢åŒ…å«'Hello'çš„æ–‡ä»¶",
    }

    for i, query := range queries {
        fmt.Printf("\n\n===== æŸ¥è¯¢ %d =====\n%s\n\n", i+1, query)

        result, err := ag.Chat(ctx, query)
        if err != nil {
            log.Printf("æŸ¥è¯¢å¤±è´¥: %v", err)
            continue
        }

        fmt.Printf("\n\nğŸ“ æœ€ç»ˆç»“æœ: %s\n", result.Text)
    }
}

func getEnv(key, defaultValue string) string {
    if value := os.Getenv(key); value != "" {
        return value
    }
    return defaultValue
}
```

## ğŸƒ æ­¥éª¤4ï¼šè¿è¡Œç¨‹åº

```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir workspace

# è¿è¡Œç¨‹åº
go run main.go
```

**é¢„æœŸè¾“å‡º**ï¼š

```
===== æŸ¥è¯¢ 1 =====
åˆ—å‡ºworkspaceç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶

ğŸ”§ [fs_ls]
   âœ… å®Œæˆ

workspaceç›®å½•å½“å‰ä¸ºç©ºã€‚

ğŸ“ æœ€ç»ˆç»“æœ: workspaceç›®å½•å½“å‰ä¸ºç©º

===== æŸ¥è¯¢ 2 =====
åˆ›å»ºä¸€ä¸ªhello.txtæ–‡ä»¶ï¼Œå†…å®¹æ˜¯'Hello AgentSDK'

ğŸ”§ [fs_write]
   âœ… å®Œæˆ

å·²åˆ›å»ºhello.txtæ–‡ä»¶ã€‚

ğŸ“ æœ€ç»ˆç»“æœ: æ–‡ä»¶å·²æˆåŠŸåˆ›å»º
...
```

## ğŸ¨ æ­¥éª¤5ï¼šæ·»åŠ äº¤äº’æ¨¡å¼

ä¿®æ”¹ `runConversation` å‡½æ•°ï¼š

```go
func runConversation(ag *agent.Agent) {
    ctx := context.Background()
    scanner := bufio.NewScanner(os.Stdin)

    fmt.Println("æ–‡ä»¶åŠ©æ‰‹å·²å°±ç»ªï¼è¾“å…¥'exit'é€€å‡ºã€‚\n")

    for {
        fmt.Print("æ‚¨: ")
        if !scanner.Scan() {
            break
        }

        query := scanner.Text()
        if query == "exit" {
            fmt.Println("å†è§ï¼")
            break
        }

        fmt.Print("\nAgent: ")
        result, err := ag.Chat(ctx, query)
        if err != nil {
            log.Printf("é”™è¯¯: %v\n", err)
            continue
        }

        fmt.Printf("\n\n")
    }
}
```

ç°åœ¨è¿è¡Œåå¯ä»¥äº¤äº’å¼å¯¹è¯ï¼š

```
æ–‡ä»¶åŠ©æ‰‹å·²å°±ç»ªï¼è¾“å…¥'exit'é€€å‡ºã€‚

æ‚¨: åˆ›å»ºä¸€ä¸ªtest.goæ–‡ä»¶
Agent: ğŸ”§ [fs_write]
   âœ… å®Œæˆ
å·²åˆ›å»ºtest.goæ–‡ä»¶ã€‚

æ‚¨: åˆ—å‡ºæ‰€æœ‰goæ–‡ä»¶
Agent: ğŸ”§ [fs_glob]
   âœ… å®Œæˆ
æ‰¾åˆ°1ä¸ªGoæ–‡ä»¶: test.go
```

## ğŸ“š å®Œæ•´ç¤ºä¾‹

æŸ¥çœ‹å®Œæ•´ä»£ç ï¼š[GitHub](https://github.com/wordflowlab/agentsdk/tree/main/examples/file-assistant)

## ğŸ¯ ä¸‹ä¸€æ­¥

- [è‡ªå®šä¹‰å·¥å…·](/guides/custom-tools) - æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½
- [ä¸­é—´ä»¶å¼€å‘](/guides/custom-middleware) - æ‰©å±•Agentèƒ½åŠ›
- [å¤šAgentåä½œ](/guides/multi-agent) - æ„å»ºå¤æ‚ç³»ç»Ÿ
