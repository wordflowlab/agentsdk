---
title: ä»£ç å®¡æŸ¥
description: ä½¿ç”¨ Agent è‡ªåŠ¨å®¡æŸ¥ä»£ç 
---

# ä»£ç å®¡æŸ¥ç¤ºä¾‹

ä½¿ç”¨ Agent è‡ªåŠ¨å®¡æŸ¥ä»£ç è´¨é‡ã€å‘ç°æ½œåœ¨é—®é¢˜ã€‚

## å®Œæ•´ä»£ç 

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"

    "github.com/wordflowlab/agentsdk/pkg/agent"
    "github.com/wordflowlab/agentsdk/pkg/provider"
    "github.com/wordflowlab/agentsdk/pkg/sandbox"
    "github.com/wordflowlab/agentsdk/pkg/store"
    "github.com/wordflowlab/agentsdk/pkg/tools"
    "github.com/wordflowlab/agentsdk/pkg/tools/builtin"
    "github.com/wordflowlab/agentsdk/pkg/types"
)

func main() {
    ctx := context.Background()

    // åˆ›å»ºå·¥å…·æ³¨å†Œè¡¨
    toolRegistry := tools.NewRegistry()
    builtin.RegisterAll(toolRegistry)

    // åˆ›å»ºä¾èµ–
    deps := &agent.Dependencies{
        ToolRegistry:     toolRegistry,
        SandboxFactory:   sandbox.NewFactory(),
        ProviderFactory:  provider.NewMultiProviderFactory(),
        Store:            store.NewMemoryStore(),
        TemplateRegistry: agent.NewTemplateRegistry(),
    }

    // åˆ›å»ºä»£ç å®¡æŸ¥ Agent
    ag, err := agent.Create(ctx, &types.AgentConfig{
        TemplateID: "assistant",
        ModelConfig: &types.ModelConfig{
            Provider: "anthropic",
            Model:    "claude-sonnet-4-5",
            APIKey:   os.Getenv("ANTHROPIC_API_KEY"),
        },
        SystemPrompt: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚

å®¡æŸ¥é‡ç‚¹ï¼š
1. ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
2. æ½œåœ¨çš„ bug å’Œå®‰å…¨é—®é¢˜
3. æ€§èƒ½ä¼˜åŒ–å»ºè®®
4. æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼

è¾“å‡ºæ ¼å¼ï¼š
## æ€»ä½“è¯„ä»·
ç®€è¦æ€»ç»“ä»£ç è´¨é‡

## å…·ä½“é—®é¢˜
æŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼š
- ğŸ”´ ä¸¥é‡é—®é¢˜
- ğŸŸ¡ è­¦å‘Š
- ğŸŸ¢ å»ºè®®

## æ”¹è¿›å»ºè®®
æä¾›å…·ä½“çš„æ”¹è¿›æ–¹æ¡ˆï¼ˆé™„ä»£ç ç¤ºä¾‹ï¼‰

## ä¼˜ç‚¹
æŒ‡å‡ºä»£ç ä¸­çš„äº®ç‚¹`,
        Tools: []string{"filesystem"},
    }, deps)
    if err != nil {
        log.Fatal(err)
    }
    defer ag.Close()

    // å®¡æŸ¥ä»£ç 
    result, err := ag.Chat(ctx, `
è¯·å®¡æŸ¥ main.go æ–‡ä»¶çš„ä»£ç è´¨é‡ã€‚
é‡ç‚¹å…³æ³¨ï¼šé”™è¯¯å¤„ç†ã€å¹¶å‘å®‰å…¨ã€èµ„æºæ³„æ¼
`)
    if err != nil {
        log.Fatal(err)
    }

    fmt.Println(result.Message.Content)
}
```

## è¾“å‡ºç¤ºä¾‹

```markdown
## æ€»ä½“è¯„ä»·
ä»£ç ç»“æ„æ¸…æ™°ï¼Œä½†å­˜åœ¨ä¸€äº›éœ€è¦æ”¹è¿›çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†æ–¹é¢ã€‚

## å…·ä½“é—®é¢˜

### ğŸ”´ ä¸¥é‡é—®é¢˜
1. **æœªå…³é—­æ–‡ä»¶å¥æŸ„** (ç¬¬ 45 è¡Œ)
   ```go
   file, _ := os.Open("config.json")
   // ç¼ºå°‘ defer file.Close()
   ```
   å½±å“ï¼šå¯èƒ½å¯¼è‡´æ–‡ä»¶å¥æŸ„æ³„æ¼

2. **å¿½ç•¥é”™è¯¯è¿”å›** (ç¬¬ 52 è¡Œ)
   ```go
   result, _ := processData(input)
   ```
   å½±å“ï¼šå¯èƒ½éšè—ä¸¥é‡é”™è¯¯

### ğŸŸ¡ è­¦å‘Š
1. **å¹¶å‘è®¿é—® map æœªåŠ é”** (ç¬¬ 78-82 è¡Œ)
   ```go
   cache[key] = value  // å¤šä¸ª goroutine å¯èƒ½åŒæ—¶è®¿é—®
   ```
   å½±å“ï¼šå¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰

2. **ç¡¬ç¼–ç é…ç½®** (ç¬¬ 15 è¡Œ)
   ```go
   const maxRetries = 3  // åº”è¯¥ä»é…ç½®æ–‡ä»¶è¯»å–
   ```

### ğŸŸ¢ å»ºè®®
1. ä½¿ç”¨ `context.WithTimeout` æ§åˆ¶è¶…æ—¶
2. æ·»åŠ æ›´å¤šçš„æ—¥å¿—è®°å½•
3. è€ƒè™‘ä½¿ç”¨ `sync.Pool` ä¼˜åŒ–å†…å­˜åˆ†é…

## æ”¹è¿›å»ºè®®

### 1. ä¿®å¤èµ„æºæ³„æ¼
```go
// ä¿®æ”¹å‰
file, _ := os.Open("config.json")
data, _ := io.ReadAll(file)

// ä¿®æ”¹å
file, err := os.Open("config.json")
if err != nil {
    return fmt.Errorf("æ‰“å¼€æ–‡ä»¶å¤±è´¥: %w", err)
}
defer file.Close()

data, err := io.ReadAll(file)
if err != nil {
    return fmt.Errorf("è¯»å–æ–‡ä»¶å¤±è´¥: %w", err)
}
```

### 2. å¹¶å‘å®‰å…¨
```go
type SafeCache struct {
    mu    sync.RWMutex
    cache map[string]interface{}
}

func (c *SafeCache) Set(key string, value interface{}) {
    c.mu.Lock()
    defer c.mu.Unlock()
    c.cache[key] = value
}
```

## ä¼˜ç‚¹
1. âœ… å‡½æ•°å‘½åæ¸…æ™°ï¼Œéµå¾ª Go æƒ¯ä¾‹
2. âœ… ä½¿ç”¨äº†æ¥å£æŠ½è±¡ï¼Œæ˜“äºæµ‹è¯•
3. âœ… ä»£ç ç»“æ„åˆç†ï¼ŒèŒè´£åˆ†æ˜
```

## å®¡æŸ¥ä¸åŒç±»å‹çš„ä»£ç 

### Go ä»£ç 

```go
result, _ := ag.Chat(ctx, "å®¡æŸ¥ server.goï¼Œé‡ç‚¹æ£€æŸ¥å¹¶å‘å®‰å…¨å’Œé”™è¯¯å¤„ç†")
```

### Python ä»£ç 

```go
result, _ := ag.Chat(ctx, "å®¡æŸ¥ app.pyï¼Œæ£€æŸ¥ PEP 8 è§„èŒƒå’Œå®‰å…¨é—®é¢˜")
```

### æ‰¹é‡å®¡æŸ¥

```go
result, _ := ag.Chat(ctx, `
å®¡æŸ¥ pkg/ ç›®å½•ä¸‹çš„æ‰€æœ‰ .go æ–‡ä»¶
ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Šï¼ŒæŒ‰é—®é¢˜ä¸¥é‡ç¨‹åº¦æ’åº
`)
```

## é›†æˆ Git

å®¡æŸ¥ Git æäº¤çš„ä»£ç ï¼š

```go
ag, _ := agent.Create(ctx, &types.AgentConfig{
    // ...
    Tools: []string{"filesystem", "bash"},
})

result, _ := ag.Chat(ctx, `
1. è¿è¡Œ git diff HEAD~1 æŸ¥çœ‹æœ€è¿‘çš„æäº¤
2. å®¡æŸ¥å˜æ›´çš„ä»£ç 
3. ç”Ÿæˆ Code Review è¯„è®º
`)
```

## ç›¸å…³èµ„æº

- [è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯](../1.agent/5.custom-prompt)
- [æ–‡ä»¶æ“ä½œå·¥å…·](../3.tools/1.file-operations)
