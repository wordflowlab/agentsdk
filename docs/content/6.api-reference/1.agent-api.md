---
title: Agent API
description: Agent核心API参考文档
---

# Agent API

## agent.Create

创建新的Agent实例。

```go
func Create(ctx context.Context, config *AgentConfig, deps *Dependencies) (*Agent, error)
```

**参数**：
- `ctx`: 上下文
- `config`: Agent配置
- `deps`: 依赖注入

**返回**：
- `*Agent`: Agent实例
- `error`: 错误信息

**示例**：

```go
ag, err := agent.Create(ctx, &types.AgentConfig{
    TemplateID: "assistant",
    ModelConfig: &types.ModelConfig{
        Provider: "anthropic",
        Model:    "claude-sonnet-4-5",
        APIKey:   os.Getenv("ANTHROPIC_API_KEY"),
    },
}, deps)
```

## agent.Chat

同步对话，阻塞等待完整响应。

```go
func (a *Agent) Chat(ctx context.Context, message string) (*ChatResult, error)
```

**参数**：
- `ctx`: 上下文
- `message`: 用户消息

**返回**：
- `*ChatResult`: 对话结果
- `error`: 错误信息

**示例**：

```go
result, err := ag.Chat(ctx, "你好")
if err != nil {
    log.Fatal(err)
}
fmt.Println(result.Text)
```

## agent.Send

异步发送消息，不等待响应。

```go
func (a *Agent) Send(ctx context.Context, message string) error
```

**示例**：

```go
// 订阅事件
eventCh := ag.Subscribe([]types.AgentChannel{types.ChannelProgress}, nil)
go handleEvents(eventCh)

// 发送消息
ag.Send(ctx, "你好")
```

## agent.Subscribe

订阅事件通道。

```go
func (a *Agent) Subscribe(channels []AgentChannel, filter *EventFilter) <-chan EventEnvelope
```

**参数**：
- `channels`: 要订阅的通道列表
- `filter`: 事件过滤器（可选）

**返回**：
- `<-chan EventEnvelope`: 事件通道

**示例**：

```go
eventCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelProgress,
    types.ChannelMonitor,
}, nil)

for envelope := range eventCh {
    // 处理事件
}
```

## agent.Close

关闭Agent，释放资源。

```go
func (a *Agent) Close() error
```

**示例**：

```go
defer ag.Close()
```

## Types

### AgentConfig

```go
type AgentConfig struct {
    ID           string
    TemplateID   string
    ModelConfig  *ModelConfig
    Sandbox      *SandboxConfig
    Middlewares  []string
    SystemPrompt string
    Tools        []interface{}
}
```

### ChatResult

```go
type ChatResult struct {
    Text       string
    StopReason string
    TokensUsed int
}
```

### EventEnvelope

```go
type EventEnvelope struct {
    ID        string
    Channel   AgentChannel
    Event     EventType
    Timestamp time.Time
}
```

完整API文档请参考：[pkg.go.dev](https://pkg.go.dev/github.com/wordflowlab/agentsdk)
