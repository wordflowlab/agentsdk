---
title: SubAgent ç³»ç»Ÿ
description: å­ Agent å§”æ‰˜ã€ä¸Šä¸‹æ–‡éš”ç¦»å’Œå¹¶è¡Œæ‰§è¡Œ
navigation:
  icon: i-lucide-git-fork
---

# SubAgent ç³»ç»Ÿ

SubAgent æ˜¯ AgentSDK çš„**ä»»åŠ¡å§”æ‰˜å’Œä¸Šä¸‹æ–‡éš”ç¦»æœºåˆ¶**ï¼Œå…è®¸ä¸» Agent å°†å¤æ‚çš„ã€å¤šæ­¥éª¤çš„ä»»åŠ¡å§”æ‰˜ç»™ä¸“é—¨çš„å­ Agent æ‰§è¡Œï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»å’Œèµ„æºä¼˜åŒ–ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### SubAgent vs ä¸» Agent

```
ä¸» Agent (Main Agent)
â”œâ”€â”€ è´Ÿè´£æ€»ä½“åè°ƒ
â”œâ”€â”€ ç®¡ç†å¯¹è¯ä¸Šä¸‹æ–‡
â”œâ”€â”€ å†³ç­–ä»»åŠ¡åˆ†é…
â””â”€â”€ æ•´åˆå­ä»»åŠ¡ç»“æœ

SubAgent (å­ Agent)
â”œâ”€â”€ ä¸“æ³¨å•ä¸€ä»»åŠ¡
â”œâ”€â”€ ç‹¬ç«‹ä¸Šä¸‹æ–‡çª—å£
â”œâ”€â”€ éš”ç¦»æ‰§è¡Œç¯å¢ƒ
â””â”€â”€ è¿”å›æ‘˜è¦ç»“æœ
```

### ä¸ºä»€ä¹ˆéœ€è¦ SubAgentï¼Ÿ

**åœºæ™¯ 1ï¼šä¸Šä¸‹æ–‡è†¨èƒ€**

```
ç”¨æˆ·ï¼šåˆ†æä¸‰ä¸ªå¤§å‹ä»£ç åº“çš„å®‰å…¨æ¼æ´

âŒ ä¸ä½¿ç”¨ SubAgentï¼š
   ä¸» Agent åˆ†ææ‰€æœ‰ä»£ç åº“
   â†’ ä¸Šä¸‹æ–‡çª—å£è¢«å¤§é‡åˆ†æç»†èŠ‚å¡«æ»¡
   â†’ Token æ¶ˆè€—å·¨å¤§
   â†’ åç»­å¯¹è¯è´¨é‡ä¸‹é™

âœ… ä½¿ç”¨ SubAgentï¼š
   ä¸» Agent â†’ å¯åŠ¨3ä¸ªå­ Agent å¹¶è¡Œåˆ†æ
   â†’ æ¯ä¸ªå­ Agent ç‹¬ç«‹åˆ†æä¸€ä¸ªä»£ç åº“
   â†’ è¿”å›æ‘˜è¦æŠ¥å‘Š
   â†’ ä¸» Agent æ•´åˆç»“æœï¼Œä¸Šä¸‹æ–‡ä¿æŒç®€æ´
```

**åœºæ™¯ 2ï¼šä¸“ä¸šåŒ–åˆ†å·¥**

```
ç”¨æˆ·ï¼šç¼–å†™æ–‡ç« ã€é…å›¾ã€æ’ç‰ˆ

âœ… ä½¿ç”¨ SubAgentï¼š
   ä¸» Agent â†’ åè°ƒ
   â”œâ”€â”€ writer SubAgent â†’ æ’°å†™æ–‡ç« 
   â”œâ”€â”€ designer SubAgent â†’ è®¾è®¡é…å›¾
   â””â”€â”€ formatter SubAgent â†’ æ ¼å¼æ’ç‰ˆ
```

**åœºæ™¯ 3ï¼šå¹¶è¡ŒåŠ é€Ÿ**

```
ç”¨æˆ·ï¼šç ”ç©¶ä¸‰å®¶å…¬å¸çš„è´¢æŠ¥

âŒ é¡ºåºæ‰§è¡Œï¼ˆæ…¢ï¼‰ï¼š
   ç ”ç©¶ A â†’ ç ”ç©¶ B â†’ ç ”ç©¶ C
   è€—æ—¶ï¼š3T

âœ… å¹¶è¡Œæ‰§è¡Œï¼ˆå¿«ï¼‰ï¼š
   åŒæ—¶å¯åŠ¨ 3 ä¸ª SubAgent
   è€—æ—¶ï¼šT
```

## ğŸ“ SubAgent æ¶æ„

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¸» Agent (Main Agent)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    SubAgentMiddleware             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  task å·¥å…· (Task Tool)       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - å¯åŠ¨å­ Agent             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ä¼ é€’ä»»åŠ¡æè¿°             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - æ¥æ”¶æ‰§è¡Œç»“æœ             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚  SubAgent Pool:                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚ Sub1 â”‚ â”‚ Sub2 â”‚ â”‚ SubN â”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸ª SubAgentï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SubAgent          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¸“ç”¨æç¤ºè¯     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ç‹¬ç«‹å·¥å…·é›†     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ç‹¬ç«‹ä¸Šä¸‹æ–‡     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ç‹¬ç«‹ä¼šè¯çŠ¶æ€   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant Main as ä¸» Agent
    participant MW as SubAgentMiddleware
    participant Sub1 as SubAgent 1
    participant Sub2 as SubAgent 2

    User->>Main: "åˆ†æé¡¹ç›® A å’Œ B çš„æ¶æ„"
    Main->>Main: åˆ†è§£ä»»åŠ¡

    par å¹¶è¡Œæ‰§è¡Œ
        Main->>MW: task("architect", "åˆ†æé¡¹ç›®A")
        MW->>Sub1: åˆ›å»º/è·å–å­Agent
        Sub1->>Sub1: ç‹¬ç«‹åˆ†æé¡¹ç›®A
        Sub1->>MW: è¿”å›æ¶æ„åˆ†æ

        Main->>MW: task("architect", "åˆ†æé¡¹ç›®B")
        MW->>Sub2: åˆ›å»º/è·å–å­Agent
        Sub2->>Sub2: ç‹¬ç«‹åˆ†æé¡¹ç›®B
        Sub2->>MW: è¿”å›æ¶æ„åˆ†æ
    end

    MW->>Main: ç»“æœ1 + ç»“æœ2
    Main->>Main: æ•´åˆåˆ†æç»“æœ
    Main->>User: å®Œæ•´å“åº”
```

## ğŸ”§ SubAgent å®šä¹‰

### SubAgentSpec è§„æ ¼

```go
type SubAgentSpec struct {
    // åŸºæœ¬ä¿¡æ¯
    Name        string   // SubAgent å”¯ä¸€æ ‡è¯†
    Description string   // åŠŸèƒ½æè¿°
    Prompt      string   // ä¸“ç”¨ç³»ç»Ÿæç¤ºè¯

    // å·¥å…·é…ç½®
    Tools       []string // å·¥å…·åˆ—è¡¨ï¼ˆç©ºåˆ™ç»§æ‰¿çˆ¶ Agentï¼‰

    // ä¸­é—´ä»¶é…ç½®
    InheritMiddlewares  bool         // æ˜¯å¦ç»§æ‰¿çˆ¶ Agent ä¸­é—´ä»¶
    MiddlewareOverrides []Middleware // ä¸“ç”¨ä¸­é—´ä»¶ï¼ˆè¦†ç›–æˆ–è¿½åŠ ï¼‰

    // è‡ªå®šä¹‰é…ç½®
    Config      map[string]interface{}
}
```

### åˆ›å»º SubAgent

**æ–¹å¼ 1ï¼šé¢„å®šä¹‰ SubAgent**

```go
subagentMW, _ := middleware.NewSubAgentMiddleware(&middleware.SubAgentMiddlewareConfig{
    Factory: createSubAgentFactory(),
    Specs: []middleware.SubAgentSpec{
        {
            Name:        "code-reviewer",
            Description: "ä»£ç å®¡æŸ¥ä¸“å®¶",
            Prompt:      "ä½ æ˜¯èµ„æ·±ä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œä¸“æ³¨äºä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œæœ€ä½³å®è·µã€‚",
            Tools:       []string{"fs_read", "grep", "bash_run"},
        },
        {
            Name:        "data-analyst",
            Description: "æ•°æ®åˆ†æä¸“å®¶",
            Prompt:      "ä½ æ˜¯æ•°æ®åˆ†æä¸“å®¶ï¼Œç²¾é€šæ•°æ®å¤„ç†ã€ç»Ÿè®¡åˆ†æå’Œå¯è§†åŒ–ã€‚",
            Tools:       []string{"python_exec", "pandas", "matplotlib"},
        },
    },
})
```

**æ–¹å¼ 2ï¼šé€šç”¨ SubAgentï¼ˆé»˜è®¤å¯ç”¨ï¼‰**

```go
// è‡ªåŠ¨å¯ç”¨ general-purpose SubAgent
subagentMW, _ := middleware.NewSubAgentMiddleware(&middleware.SubAgentMiddlewareConfig{
    Factory:              createSubAgentFactory(),
    EnableGeneralPurpose: true, // é»˜è®¤ true
})

// general-purpose SubAgent æ‹¥æœ‰æ‰€æœ‰å·¥å…·ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ä»»åŠ¡
```

## ğŸ® ä½¿ç”¨ task å·¥å…·

### task å·¥å…·å‚æ•°

```typescript
interface TaskInput {
    description: string;      // ä»»åŠ¡æè¿°ï¼ˆå¿…éœ€ï¼‰
    subagent_type: string;    // SubAgent ç±»å‹ï¼ˆå¿…éœ€ï¼‰
    context?: object;         // çˆ¶ Agent ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
}
```

### è°ƒç”¨ç¤ºä¾‹

**å•ä¸ªä»»åŠ¡**ï¼š

```go
// ä¸» Agent ä½¿ç”¨ task å·¥å…·
result, _ := ag.Chat(ctx, `
è¯·ä½¿ç”¨ task å·¥å…·åˆ†æ main.go çš„ä»£ç è´¨é‡ï¼š

tool_use:
  name: task
  parameters:
    description: |
      åˆ†æ main.go æ–‡ä»¶çš„ä»£ç è´¨é‡ï¼Œæ£€æŸ¥ï¼š
      1. é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„
      2. æ˜¯å¦æœ‰å®‰å…¨æ¼æ´
      3. ä»£ç ç»“æ„æ˜¯å¦åˆç†
      4. è¿”å›è¯¦ç»†çš„å®¡æŸ¥æŠ¥å‘Š
    subagent_type: code-reviewer
`)
```

**å¹¶è¡Œä»»åŠ¡**ï¼ˆé‡è¦ï¼ï¼‰ï¼š

```go
// åŒæ—¶å¯åŠ¨å¤šä¸ª SubAgent å¹¶è¡Œæ‰§è¡Œ
result, _ := ag.Chat(ctx, `
è¯·å¹¶è¡Œåˆ†æä¸‰ä¸ªé¡¹ç›®ï¼š

tool_use:
  name: task
  parameters:
    description: "åˆ†æ project-a çš„æ¶æ„è®¾è®¡"
    subagent_type: architect

tool_use:
  name: task
  parameters:
    description: "åˆ†æ project-b çš„æ¶æ„è®¾è®¡"
    subagent_type: architect

tool_use:
  name: task
  parameters:
    description: "åˆ†æ project-c çš„æ¶æ„è®¾è®¡"
    subagent_type: architect
`)
```

## ğŸ“‹ ä½¿ç”¨åœºæ™¯

### 1. å¹¶è¡Œç ”ç©¶

**åœºæ™¯**ï¼šéœ€è¦ä»å¤šä¸ªæ¥æºæ”¶é›†ä¿¡æ¯

```go
// ç”¨æˆ·ï¼šç ”ç©¶ä¸‰ç§ç¼–ç¨‹è¯­è¨€çš„ä¼˜ç¼ºç‚¹

ä¸» Agent:
  â””â”€> å¹¶è¡Œå¯åŠ¨ 3 ä¸ª SubAgent
      â”œâ”€> research-agent: "ç ”ç©¶ Go è¯­è¨€"
      â”œâ”€> research-agent: "ç ”ç©¶ Python è¯­è¨€"
      â””â”€> research-agent: "ç ”ç©¶ Rust è¯­è¨€"

      æ”¶é›†ç»“æœ â†’ å¯¹æ¯”åˆ†æ â†’ ç»™å‡ºå»ºè®®
```

**ä¼˜åŠ¿**ï¼š
- âš¡ é€Ÿåº¦å¿« 3 å€ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
- ğŸ’° Token ä¼˜åŒ–ï¼ˆæ¯ä¸ªå­ Agent åªè¿”å›æ‘˜è¦ï¼‰
- ğŸ¯ ä¸Šä¸‹æ–‡éš”ç¦»ï¼ˆä¸äº’ç›¸æ±¡æŸ“ï¼‰

### 2. å¤æ‚ä»»åŠ¡åˆ†è§£

**åœºæ™¯**ï¼šå¤§å‹ä»»åŠ¡éœ€è¦å¤šä¸ªæ­¥éª¤

```go
// ç”¨æˆ·ï¼šä¸ºæˆ‘çš„åˆ›ä¸šé¡¹ç›®å†™å•†ä¸šè®¡åˆ’ä¹¦

ä¸» Agent:
  â””â”€> é¡ºåºå¯åŠ¨å¤šä¸ª SubAgent
      â”œâ”€> market-research: "å¸‚åœºè°ƒç ”"
      â”œâ”€> competitor-analysis: "ç«äº‰å¯¹æ‰‹åˆ†æ"
      â”œâ”€> financial-planning: "è´¢åŠ¡è§„åˆ’"
      â””â”€> content-writer: "æ’°å†™å•†ä¸šè®¡åˆ’ä¹¦"

      æ¯ä¸ª SubAgent ä¸“æ³¨ä¸€ä¸ªé¢†åŸŸ â†’ ä¸» Agent æ•´åˆ
```

**ä¼˜åŠ¿**ï¼š
- ğŸ“š ä¸“ä¸šåŒ–ï¼ˆæ¯ä¸ª SubAgent æœ‰ä¸“é—¨æç¤ºè¯å’Œå·¥å…·ï¼‰
- ğŸ§¹ ä¸Šä¸‹æ–‡æ¸…æ™°ï¼ˆä¸» Agent åªçœ‹æ‘˜è¦ï¼‰
- ğŸ”„ å¯å¤ç”¨ï¼ˆSubAgent å¯ç”¨äºå…¶ä»–ä»»åŠ¡ï¼‰

### 3. ä¸Šä¸‹æ–‡éš”ç¦»

**åœºæ™¯**ï¼šé˜²æ­¢ä¸» Agent ä¸Šä¸‹æ–‡è¢«æ±¡æŸ“

```go
// ç”¨æˆ·ï¼šåˆ†æè¿™ä¸ª 10MB çš„æ—¥å¿—æ–‡ä»¶

ä¸» Agent:
  â””â”€> SubAgent("log-analyzer", "åˆ†ææ—¥å¿—æ–‡ä»¶å¹¶è¿”å›å¼‚å¸¸æ‘˜è¦")
      â”œâ”€> SubAgent è¯»å–å’Œåˆ†æå¤§é‡æ—¥å¿—
      â”œâ”€> åœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­å¤„ç†æ•°æ®
      â””â”€> è¿”å›ç®€æ´çš„å¼‚å¸¸åˆ—è¡¨

ä¸» Agent ä¸Šä¸‹æ–‡ï¼š
  â”œâ”€ ç”¨æˆ·æ¶ˆæ¯
  â”œâ”€ å¼‚å¸¸æ‘˜è¦ï¼ˆ< 1KBï¼‰
  â””â”€ åç»­å¯¹è¯ä¿æŒè½»é‡
```

**ä¼˜åŠ¿**ï¼š
- ğŸ’¾ å†…å­˜ä¼˜åŒ–ï¼ˆä¸» Agent ä¸å­˜å‚¨è¯¦ç»†æ—¥å¿—ï¼‰
- âš¡ å“åº”é€Ÿåº¦ï¼ˆä¸Šä¸‹æ–‡å°ï¼‰
- ğŸ’° æˆæœ¬é™ä½ï¼ˆToken ä½¿ç”¨å°‘ï¼‰

### 4. ä¸“ä¸šåŒ– Agent

**åœºæ™¯**ï¼šä¸åŒé¢†åŸŸéœ€è¦ä¸åŒä¸“å®¶

```go
// å¤šé¢†åŸŸå†…å®¹åˆ›ä½œç³»ç»Ÿ

SubAgents:
  â”œâ”€> tech-writer: æŠ€æœ¯æ–‡æ¡£ä¸“å®¶
  â”œâ”€> marketing-copywriter: è¥é”€æ–‡æ¡ˆä¸“å®¶
  â”œâ”€> legal-advisor: æ³•å¾‹é¡¾é—®ä¸“å®¶
  â””â”€> translator: ç¿»è¯‘ä¸“å®¶

ä¸» Agent æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„ SubAgent
```

## âš™ï¸ é«˜çº§é…ç½®

### 1. ä¸­é—´ä»¶ç»§æ‰¿

**ç»§æ‰¿çˆ¶ Agent ä¸­é—´ä»¶**ï¼š

```go
SubAgentSpec{
    Name:               "data-processor",
    InheritMiddlewares: true, // ç»§æ‰¿æ‰€æœ‰çˆ¶ Agent ä¸­é—´ä»¶
}
```

**ä¸ç»§æ‰¿ï¼ˆç‹¬ç«‹ä¸­é—´ä»¶æ ˆï¼‰**ï¼š

```go
SubAgentSpec{
    Name:               "isolated-agent",
    InheritMiddlewares: false, // ä¸ç»§æ‰¿
    MiddlewareOverrides: []Middleware{
        // ä»…ä½¿ç”¨è¿™äº›ä¸­é—´ä»¶
        customLogger,
        customSandbox,
    },
}
```

**è¦†ç›–ç‰¹å®šä¸­é—´ä»¶**ï¼š

```go
SubAgentSpec{
    Name:               "custom-agent",
    InheritMiddlewares: true,  // ç»§æ‰¿
    MiddlewareOverrides: []Middleware{
        // è¦†ç›–åŒåä¸­é—´ä»¶
        customFilesystemMiddleware, // è¦†ç›–çˆ¶ Agent çš„ filesystem
    },
}
```

### 2. å·¥å…·é…ç½®

**ç»§æ‰¿æ‰€æœ‰å·¥å…·**ï¼š

```go
SubAgentSpec{
    Name:  "general-agent",
    Tools: nil, // æˆ– []string{} - ç»§æ‰¿æ‰€æœ‰å·¥å…·
}
```

**é™å®šå·¥å…·é›†**ï¼š

```go
SubAgentSpec{
    Name:  "read-only-agent",
    Tools: []string{"fs_read", "grep", "web_search"},
    // åªèƒ½ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæé«˜å®‰å…¨æ€§
}
```

### 3. ä¸Šä¸‹æ–‡ä¼ é€’

**ä¼ é€’éƒ¨åˆ†ä¸Šä¸‹æ–‡**ï¼š

```go
result, _ := ag.Chat(ctx, `
tool_use:
  name: task
  parameters:
    description: "åŸºäºç”¨æˆ·åå¥½æ¨èäº§å“"
    subagent_type: recommender
    context:
      user_id: "12345"
      preferences:
        category: "electronics"
        price_range: "500-1000"
`)
```

**SubAgent æ¥æ”¶ä¸Šä¸‹æ–‡**ï¼š

```go
func (a *RecommenderAgent) Execute(ctx context.Context, description string, parentContext map[string]interface{}) (string, error) {
    userID := parentContext["user_id"].(string)
    preferences := parentContext["preferences"].(map[string]interface{})

    // ä½¿ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯æ‰§è¡Œä»»åŠ¡
    // ...
}
```

## ğŸš€ æœ€ä½³å®è·µ

### 1. å¹¶è¡ŒåŒ–ä¼˜å…ˆ

**âœ… æ¨è**ï¼š

```go
// å¹¶è¡Œå¯åŠ¨å¤šä¸ªä»»åŠ¡ï¼ˆåœ¨ä¸€æ¡æ¶ˆæ¯ä¸­ï¼‰
tool_use: task("research", "ç ”ç©¶ä¸»é¢˜A")
tool_use: task("research", "ç ”ç©¶ä¸»é¢˜B")
tool_use: task("research", "ç ”ç©¶ä¸»é¢˜C")
// é€Ÿåº¦å¿« 3 å€ï¼
```

**âŒ é¿å…**ï¼š

```go
// é¡ºåºæ‰§è¡Œï¼ˆæ…¢ï¼‰
tool_use: task("research", "ç ”ç©¶ä¸»é¢˜A")
// ç­‰å¾…ç»“æœ...
tool_use: task("research", "ç ”ç©¶ä¸»é¢˜B")
// ç­‰å¾…ç»“æœ...
tool_use: task("research", "ç ”ç©¶ä¸»é¢˜C")
```

### 2. è¯¦ç»†çš„ä»»åŠ¡æè¿°

**âœ… æ¨è**ï¼š

```go
description: `
åˆ†æ main.go æ–‡ä»¶çš„ä»£ç è´¨é‡ï¼Œè¯·æ£€æŸ¥ï¼š
1. é”™è¯¯å¤„ç†ï¼šæ˜¯å¦æ‰€æœ‰é”™è¯¯éƒ½è¢«æ­£ç¡®å¤„ç†
2. å®‰å…¨æ¼æ´ï¼šæ£€æŸ¥ SQL æ³¨å…¥ã€XSSã€CSRF ç­‰
3. ä»£ç ç»“æ„ï¼šå‡½æ•°æ˜¯å¦è¿‡é•¿ï¼Œæ˜¯å¦éœ€è¦é‡æ„
4. æ€§èƒ½é—®é¢˜ï¼šæ˜¯å¦æœ‰æ˜æ˜¾çš„æ€§èƒ½ç“¶é¢ˆ

è¯·è¿”å›è¯¦ç»†çš„å®¡æŸ¥æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- é—®é¢˜åˆ—è¡¨ï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼‰
- æ¯ä¸ªé—®é¢˜çš„å…·ä½“ä½ç½®ï¼ˆæ–‡ä»¶å:è¡Œå·ï¼‰
- ä¿®å¤å»ºè®®
`
```

**âŒ é¿å…**ï¼š

```go
description: "å®¡æŸ¥ä»£ç "  // å¤ªç®€ç•¥ï¼ŒSubAgent ä¸çŸ¥é“è¦åšä»€ä¹ˆ
```

### 3. é€‰æ‹©åˆé€‚çš„ SubAgent ç±»å‹

**ä¸“ä¸šåŒ– SubAgent**ï¼ˆæ¨èï¼‰ï¼š

```go
// é’ˆå¯¹ç‰¹å®šä»»åŠ¡ä½¿ç”¨ä¸“ä¸š SubAgent
task("code-reviewer", "å®¡æŸ¥ä»£ç ")
task("data-analyst", "åˆ†ææ•°æ®")
task("content-writer", "æ’°å†™æ–‡æ¡£")
```

**é€šç”¨ SubAgent**ï¼ˆå¤‡é€‰ï¼‰ï¼š

```go
// ä»»åŠ¡ä¸æ˜ç¡®æ—¶ä½¿ç”¨é€šç”¨ SubAgent
task("general-purpose", "æ‰§è¡Œå¤æ‚ä»»åŠ¡")
```

### 4. ä½•æ—¶ä½¿ç”¨ SubAgent

**âœ… åº”è¯¥ä½¿ç”¨**ï¼š

- ä»»åŠ¡å¤æ‚ä¸”éœ€è¦å¤šä¸ªæ­¥éª¤
- ä»»åŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå¯ä»¥å¹¶è¡Œ
- ä»»åŠ¡ä¼šæ¶ˆè€—å¤§é‡ Token/Context
- éœ€è¦ä¸“ä¸šåŒ–å¤„ç†ï¼ˆä¸åŒé¢†åŸŸï¼‰
- éœ€è¦ä¸Šä¸‹æ–‡éš”ç¦»

**âŒ ä¸åº”è¯¥ä½¿ç”¨**ï¼š

- ä»»åŠ¡éå¸¸ç®€å•ï¼ˆå‡ ä¸ªå·¥å…·è°ƒç”¨ï¼‰
- éœ€è¦æŸ¥çœ‹è¯¦ç»†çš„ä¸­é—´æ­¥éª¤
- ä»»åŠ¡ä¹‹é—´å¼ºä¾èµ–ï¼Œæ— æ³•å¹¶è¡Œ
- å§”æ‰˜åè€Œå¢åŠ å¤æ‚åº¦

### 5. ä¿¡ä»» SubAgent è¾“å‡º

SubAgent æ˜¯é«˜æ•ˆä¸”å¯é çš„ï¼Œé€šå¸¸åº”è¯¥ä¿¡ä»»å…¶è¾“å‡ºï¼š

```go
// âœ… æ¨è
result := subagent.Execute(...)
// ç›´æ¥ä½¿ç”¨ç»“æœ

// âŒ é¿å…
result := subagent.Execute(...)
// å†æ¬¡éªŒè¯ç»“æœï¼ˆé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼‰
```

## ğŸ”„ SubAgent ç”Ÿå‘½å‘¨æœŸ

```
1. åˆ›å»º (Creation)
   â”œâ”€> æ ¹æ® SubAgentSpec åˆ›å»ºå®ä¾‹
   â”œâ”€> åˆå§‹åŒ–ä¸“ç”¨æç¤ºè¯
   â”œâ”€> é…ç½®å·¥å…·é›†
   â””â”€> è®¾ç½®ä¸­é—´ä»¶æ ˆ

2. æ‰§è¡Œ (Execution)
   â”œâ”€> æ¥æ”¶ä»»åŠ¡æè¿°
   â”œâ”€> æ¥æ”¶çˆ¶ Agent ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
   â”œâ”€> åœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ
   â””â”€> è¿”å›æ‘˜è¦ç»“æœ

3. å¤ç”¨ (Reuse)
   â”œâ”€> SubAgent å®ä¾‹å¯ä»¥å¤ç”¨
   â””â”€> å¤„ç†å¤šä¸ªç›¸ä¼¼ä»»åŠ¡

4. å…³é—­ (Close)
   â”œâ”€> ä¸» Agent å…³é—­æ—¶
   â””â”€> æ¸…ç†æ‰€æœ‰ SubAgent èµ„æº
```

## ğŸ¯ SubAgent vs Workflow Agent

| ç‰¹æ€§ | SubAgent | Workflow Agent |
|------|---------|---------------|
| **ç”¨é€”** | ä»»åŠ¡å§”æ‰˜ã€ä¸Šä¸‹æ–‡éš”ç¦» | å·¥ä½œæµç¼–æ’ |
| **è°ƒç”¨æ–¹å¼** | ä¸» Agent è°ƒç”¨ task å·¥å…· | ç›´æ¥åˆ›å»º Workflow Agent |
| **æ‰§è¡Œæ–¹å¼** | ä¸» Agent å†³å®šä½•æ—¶è°ƒç”¨ | é¢„å®šä¹‰æ‰§è¡Œæµç¨‹ |
| **çµæ´»æ€§** | é«˜ï¼ˆåŠ¨æ€å†³ç­–ï¼‰ | ä¸­ï¼ˆå›ºå®šæµç¨‹ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | åŠ¨æ€ä»»åŠ¡å§”æ‰˜ | å›ºå®šå·¥ä½œæµç¨‹ |

**ç»„åˆä½¿ç”¨**ï¼š

```go
// Workflow Agent ä¸­ä½¿ç”¨ SubAgent
SequentialAgent:
  â”œâ”€> Step 1: SubAgent("researcher", "ç ”ç©¶èƒŒæ™¯")
  â”œâ”€> Step 2: SubAgent("analyst", "åˆ†ææ•°æ®")
  â””â”€> Step 3: SubAgent("writer", "æ’°å†™æŠ¥å‘Š")
```

## ğŸ“š ç›¸å…³èµ„æº

- [å¤š Agent åä½œ](/multi-agent/overview) - SubAgent ä½¿ç”¨ç¤ºä¾‹
- [Workflow Agent](/core-concepts/workflow-agents) - å·¥ä½œæµç¼–æ’
- [ä¸­é—´ä»¶ç³»ç»Ÿ](/core-concepts/middleware) - ç†è§£ SubAgentMiddleware
- [SubAgent API å‚è€ƒ](/api-reference/subagent) - å®Œæ•´ API æ–‡æ¡£
- [SubAgent æœ€ä½³å®è·µ](/best-practices/subagent) - é«˜çº§æŠ€å·§

## âš¡ å¿«é€Ÿå¼€å§‹

```go
package main

import (
    "context"
    "github.com/wordflowlab/agentsdk/pkg/agent"
    "github.com/wordflowlab/agentsdk/pkg/middleware"
)

func main() {
    ctx := context.Background()

    // 1. åˆ›å»º SubAgent ä¸­é—´ä»¶
    subagentMW, _ := middleware.NewSubAgentMiddleware(&middleware.SubAgentMiddlewareConfig{
        Factory: yourSubAgentFactory,
        Specs: []middleware.SubAgentSpec{
            {
                Name:        "researcher",
                Description: "ç ”ç©¶ä¸“å®¶",
                Prompt:      "ä½ æ˜¯ä¸“ä¸šç ”ç©¶å‘˜...",
            },
        },
    })

    // 2. åˆ›å»ºä¸» Agent
    ag, _ := agent.Create(ctx, &types.AgentConfig{
        TemplateID: "assistant",
        Middlewares: []middleware.Middleware{subagentMW},
    }, deps)

    // 3. ä½¿ç”¨ SubAgent
    ag.Chat(ctx, `
è¯·ä½¿ç”¨ task å·¥å…·ç ”ç©¶ AI Agent çš„æœ€æ–°è¿›å±•ï¼Œ
å¹¶æ’°å†™ä¸€ä»½æ‘˜è¦æŠ¥å‘Šã€‚
    `)
}
```

---

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. âœ… **å¹¶è¡ŒåŒ–**ï¼šåœ¨ä¸€æ¡æ¶ˆæ¯ä¸­åŒæ—¶å¯åŠ¨å¤šä¸ª SubAgent
2. âœ… **ä¸Šä¸‹æ–‡éš”ç¦»**ï¼šæ¯ä¸ª SubAgent æœ‰ç‹¬ç«‹ä¸Šä¸‹æ–‡
3. âœ… **ä¸“ä¸šåŒ–**ï¼šä½¿ç”¨ä¸“é—¨çš„ SubAgent å¤„ç†ä¸åŒé¢†åŸŸä»»åŠ¡
4. âœ… **Token ä¼˜åŒ–**ï¼šSubAgent åªè¿”å›æ‘˜è¦ï¼ŒèŠ‚çœä¸» Agent ä¸Šä¸‹æ–‡
5. âœ… **è¯¦ç»†æŒ‡ä»¤**ï¼šç»™ SubAgent æ˜ç¡®ã€è¯¦ç»†çš„ä»»åŠ¡æè¿°
