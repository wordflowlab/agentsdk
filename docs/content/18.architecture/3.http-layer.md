# HTTP å±‚æ¶æ„ (cmd/agentsdk)

> **è®¾è®¡åŸåˆ™**: æ ¸å¿ƒ SDK ä¸ HTTP æ¡†æ¶è§£è€¦  
> **æœ€åæ›´æ–°**: 2024å¹´11æœˆ17æ—¥

---

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒåŸåˆ™

**åˆ†å±‚æ¶æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   cmd/agentsdk (CLI å·¥å…·)           â”‚
â”‚   - ä½¿ç”¨ Gin æ¡†æ¶                    â”‚
â”‚   - HTTP Server å®ç°                 â”‚
â”‚   - å­å‘½ä»¤å®ç°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pkg/* (æ ¸å¿ƒ SDK)                  â”‚
â”‚   - é›¶ HTTP æ¡†æ¶ä¾èµ–                 â”‚
â”‚   - çº¯ Go æ ‡å‡†åº“ + å¿…è¦ç¬¬ä¸‰æ–¹åº“      â”‚
â”‚   - å¯è¢«ä»»ä½•é¡¹ç›®å®‰å…¨å¯¼å…¥             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾èµ–éš”ç¦»**:
- `cmd/*` â†’ å¯ä»¥ä¾èµ–ä»»ä½•æ¡†æ¶ï¼ˆGin, Chi, Echo ç­‰ï¼‰
- `pkg/*` â†’ åªèƒ½ä¾èµ–æ ‡å‡†åº“å’Œæ ¸å¿ƒç¬¬ä¸‰æ–¹åº“ï¼ˆä¸åŒ…æ‹¬ HTTP æ¡†æ¶ï¼‰

---

## ç›®å½•ç»“æ„

```
cmd/agentsdk/
â”œâ”€â”€ main.go                      # å…¥å£ï¼Œå­å‘½ä»¤è·¯ç”±
â”œâ”€â”€ serve.go                     # HTTP Server (ä½¿ç”¨ Gin)
â”œâ”€â”€ http_handlers.go             # Gin HTTP handlers
â”œâ”€â”€ agent_handlers.go            # Agent API handlers
â”œâ”€â”€ memory_handlers.go           # Memory API handlers
â”œâ”€â”€ memory_handlers_extended.go  # Semantic Memory handlers
â”œâ”€â”€ session_handlers.go          # Session API handlers
â”œâ”€â”€ workflow_handlers.go         # Workflow API handlers
â”œâ”€â”€ tool_handlers.go             # Tool API handlers
â”œâ”€â”€ middleware_handlers.go       # Middleware API handlers
â”œâ”€â”€ telemetry_handlers.go        # Telemetry API handlers
â”œâ”€â”€ eval_handlers.go             # Eval API handlers
â”œâ”€â”€ mcp_handlers.go              # MCP API handlers
â”œâ”€â”€ mcp_serve.go                 # MCP æœåŠ¡å­å‘½ä»¤
â”œâ”€â”€ subagent.go                  # Subagent å­å‘½ä»¤
â””â”€â”€ eval.go                      # Eval å­å‘½ä»¤
```

**èŒè´£**:
- CLI å·¥å…·å…¥å£
- HTTP Server å®ç°ï¼ˆä½¿ç”¨ Ginï¼‰
- å­å‘½ä»¤å®ç°
- ä¸ä½œä¸ºåº“è¢«å¯¼å…¥

---

## API ç«¯ç‚¹è®¾è®¡

### 100+ REST API ç«¯ç‚¹

```
ğŸ“Š æ ¸å¿ƒä¸šåŠ¡ (40+)
â”œâ”€â”€ POST/GET/DELETE  /v1/agents
â”œâ”€â”€ POST             /v1/agents/chat
â”œâ”€â”€ POST             /v1/agents/chat/stream
â”œâ”€â”€ GET/PUT          /v1/memory/working
â”œâ”€â”€ POST             /v1/memory/semantic/search
â”œâ”€â”€ POST/GET/DELETE  /v1/sessions
â”œâ”€â”€ POST/GET/DELETE  /v1/workflows
â””â”€â”€ POST             /v1/workflows/{id}/execute

ğŸ› ï¸ å·¥å…·å’ŒæŠ€èƒ½ (20+)
â”œâ”€â”€ POST/GET/DELETE  /v1/tools
â”œâ”€â”€ POST             /v1/tools/{id}/execute
â”œâ”€â”€ POST/GET         /v1/skills
â””â”€â”€ POST             /v1/skills/install

ğŸ”Œ ç”Ÿæ€é›†æˆ (15+)
â”œâ”€â”€ POST/GET/DELETE  /v1/mcp/servers
â”œâ”€â”€ POST             /v1/mcp/servers/{id}/connect
â”œâ”€â”€ GET              /v1/router/models
â””â”€â”€ POST             /v1/sandbox/execute

ğŸ“ˆ å¯è§‚æµ‹æ€§ (15+)
â”œâ”€â”€ POST             /v1/telemetry/metrics
â”œâ”€â”€ POST             /v1/telemetry/traces
â”œâ”€â”€ GET              /v1/telemetry/health
â”œâ”€â”€ POST             /v1/evals/text
â””â”€â”€ GET              /v1/evals

âš™ï¸ ç®¡ç†åŠŸèƒ½ (10+)
â”œâ”€â”€ POST/GET/DELETE  /v1/middlewares
â”œâ”€â”€ POST/GET/DELETE  /v1/providers
â”œâ”€â”€ POST/GET/DELETE  /v1/templates
â””â”€â”€ GET              /v1/security/policies
```

---

## ä½¿ç”¨æ–¹å¼

### ä½œä¸º CLI å·¥å…·ä½¿ç”¨

```bash
# ç¼–è¯‘
go build -o agentsdk ./cmd/agentsdk

# è¿è¡Œ HTTP Serverï¼ˆä½¿ç”¨ Ginï¼‰
./agentsdk serve --addr :8080

# è¿è¡Œå…¶ä»–å­å‘½ä»¤
./agentsdk mcp-serve
./agentsdk subagent --type=Plan
./agentsdk eval
```

### è‡ªå·±å®ç° HTTP å±‚ï¼ˆç”¨ä»»ä½•æ¡†æ¶ï¼‰

#### ä½¿ç”¨ Gin

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/wordflowlab/agentsdk/pkg/agent"
)

func main() {
    r := gin.Default()
    
    // ä½¿ç”¨ AgentSDK æ ¸å¿ƒåŠŸèƒ½
    r.POST("/chat", func(c *gin.Context) {
        // åˆ›å»º Agent å¹¶è°ƒç”¨
        ag, _ := agent.Create(...)
        result, _ := ag.Chat(...)
        c.JSON(200, result)
    })
    
    r.Run(":8080")
}
```

#### ä½¿ç”¨ Echo

```go
package main

import (
    "github.com/labstack/echo/v4"
    "github.com/wordflowlab/agentsdk/pkg/agent"
)

func main() {
    e := echo.New()
    
    e.POST("/chat", func(c echo.Context) error {
        ag, _ := agent.Create(...)
        result, _ := ag.Chat(...)
        return c.JSON(200, result)
    })
    
    e.Start(":8080")
}
```

#### ä½¿ç”¨æ ‡å‡†åº“

```go
package main

import (
    "net/http"
    "github.com/wordflowlab/agentsdk/pkg/agent"
)

func main() {
    http.HandleFunc("/chat", func(w http.ResponseWriter, r *http.Request) {
        ag, _ := agent.Create(...)
        result, _ := ag.Chat(...)
        json.NewEncoder(w).Encode(result)
    })
    
    http.ListenAndServe(":8080", nil)
}
```

---

## å“åº”æ ¼å¼

### ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
  "success": true,
  "data": { ... }
}
```

```json
{
  "success": false,
  "error": {
    "code": "bad_request",
    "message": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"
  }
}
```

### æµå¼å“åº”ï¼ˆSSEï¼‰

```
event: thinking
data: {"content": "æˆ‘æ­£åœ¨æ€è€ƒ..."}

event: text_chunk
data: {"delta": "Hello"}

event: tool_start
data: {"tool": "read_file", "args": {...}}

event: tool_end
data: {"tool": "read_file", "result": {...}}

event: done
data: {"final_text": "Hello, world!"}
```

---

## ä¾èµ–ç®¡ç†

### go.mod è®¾è®¡

```go
module github.com/wordflowlab/agentsdk

go 1.21

require (
    // æ ¸å¿ƒä¾èµ–ï¼ˆæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šå¼•å…¥ï¼‰
    github.com/google/uuid v1.6.0
    // ... å…¶ä»–æ ¸å¿ƒä¾èµ–
)

require (
    // HTTP æ¡†æ¶ä¾èµ–ï¼ˆåªåœ¨ cmd/agentsdk ä¸­ä½¿ç”¨ï¼‰
    // ç”¨æˆ·å¯¼å…¥ pkg/* æ—¶ä¸ä¼šå¼•å…¥è¿™äº›ä¾èµ–
    github.com/gin-gonic/gin v1.11.0
)
```

### ä¾èµ–æ£€æŸ¥

```bash
# æ£€æŸ¥ pkg ä¸‹æ˜¯å¦æœ‰ Gin ä¾èµ–
grep -r "gin-gonic/gin" pkg/

# åº”è¯¥è¿”å›ç©ºï¼ˆpkg ä¸‹ä¸èƒ½æœ‰ Gin ä¾èµ–ï¼‰
```

---

## çº¦æŸå’Œè§„åˆ™

### âœ… å…è®¸

**åœ¨ cmd/agentsdk/ ä¸­**:
- âœ… ä½¿ç”¨ Gin
- âœ… ä½¿ç”¨ä»»ä½• HTTP æ¡†æ¶
- âœ… ä½¿ç”¨ä»»ä½• CLI åº“

**åœ¨ pkg/ ä¸­**:
- âœ… ä½¿ç”¨æ ‡å‡†åº“ï¼ˆ`net/http` ç”¨äºç±»å‹å®šä¹‰ï¼‰
- âœ… ä½¿ç”¨æ ¸å¿ƒç¬¬ä¸‰æ–¹åº“ï¼ˆUUID, æ—¥å¿—ç­‰ï¼‰
- âœ… å®šä¹‰æ¥å£è€Œä¸æ˜¯å®ç° HTTP handler

### âŒ ç¦æ­¢

**åœ¨ pkg/ ä¸­**:
- âŒ å¯¼å…¥ `github.com/gin-gonic/gin`
- âŒ å¯¼å…¥ `github.com/labstack/echo`
- âŒ å¯¼å…¥ `github.com/go-chi/chi`
- âŒ å¯¼å…¥ä»»ä½• HTTP æ¡†æ¶

---

## æœ€ä½³å®è·µ

### 1. ä½œä¸º SDK ä½œè€…

```go
// âœ… å¥½çš„åšæ³•ï¼ˆåœ¨ pkg/ ä¸­ï¼‰
package agent

// å®šä¹‰æ¥å£
type Agent interface {
    Chat(ctx context.Context, input string) (*Result, error)
}

// å®ç°é€»è¾‘ï¼Œä¸ä¾èµ– HTTP æ¡†æ¶
func Create(ctx context.Context, config *Config) (Agent, error) {
    // ...
}
```

```go
// âŒ åçš„åšæ³•ï¼ˆåœ¨ pkg/ ä¸­ï¼‰
package agent

import "github.com/gin-gonic/gin"  // âŒ ä¸è¦è¿™æ ·ï¼

func HandleChat(c *gin.Context) {  // âŒ ä¸è¦è¿™æ ·ï¼
    // ...
}
```

### 2. ä½œä¸º SDK ç”¨æˆ·

```go
// âœ… å®‰å…¨å¯¼å…¥
import (
    "github.com/wordflowlab/agentsdk/pkg/agent"
    "github.com/wordflowlab/agentsdk/pkg/memory"
    // ä¸ä¼šå¼•å…¥ Ginï¼
)

// âœ… è‡ªå·±é€‰æ‹©æ¡†æ¶
import "github.com/gin-gonic/gin"     // ä½ çš„é¡¹ç›®å¯ä»¥ç”¨ Gin
// æˆ–
import "github.com/labstack/echo/v4"  // æˆ–è€… Echo
// æˆ–
import "net/http"                     // æˆ–è€…æ ‡å‡†åº“
```

---

## å¯¹æ¯”

| æ–¹é¢ | æ—§æ¶æ„ | æ–°æ¶æ„ |
|------|--------|--------|
| **HTTP æ¡†æ¶** | pkg ä¸­ä½¿ç”¨ Gin | åªåœ¨ cmd ä¸­ä½¿ç”¨ |
| **SDK å¯¼å…¥** | ä¼šå¼•å…¥ Gin ä¾èµ– | ä¸ä¼šå¼•å…¥ Gin |
| **çµæ´»æ€§** | ç”¨æˆ·è¢«å¼ºåˆ¶ä½¿ç”¨ Gin | ç”¨æˆ·å¯ç”¨ä»»ä½•æ¡†æ¶ |
| **å…¼å®¹æ€§** | å¯èƒ½ç‰ˆæœ¬å†²çª | å®Œå…¨éš”ç¦» |
| **ç»´æŠ¤æ€§** | pkg è†¨èƒ€ | æ¸…æ™°åˆ†å±‚ |

---

## æ€»ç»“

### æ ¸å¿ƒæ€æƒ³
**SDK æ ¸å¿ƒä¸åº”è¯¥ä¾èµ–ä»»ä½• HTTP æ¡†æ¶ï¼Œè®©ç”¨æˆ·è‡ªç”±é€‰æ‹©**

### æ”¶ç›Š
1. âœ… ç”¨æˆ·å¯ä»¥ç”¨ä»»ä½• HTTP æ¡†æ¶
2. âœ… é¿å…ä¾èµ–å†²çª
3. âœ… æ›´å°çš„ä¾èµ–æ ‘
4. âœ… æ›´å¥½çš„æ¨¡å—åŒ–
5. âœ… æ›´å®¹æ˜“ç»´æŠ¤

### åŸåˆ™
- **æ ¸å¿ƒåœ¨ pkg/**ï¼šçº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘
- **HTTP åœ¨ cmd/**ï¼šå…·ä½“çš„å®ç°ç»†èŠ‚
- **ç”¨æˆ·è‡ªç”±**ï¼šæƒ³ç”¨ä»€ä¹ˆæ¡†æ¶å°±ç”¨ä»€ä¹ˆ

---

**ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2024å¹´11æœˆ17æ—¥
