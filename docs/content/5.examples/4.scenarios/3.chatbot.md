---
title: æ™ºèƒ½å®¢æœæœºå™¨äºº
description: æ„å»ºå®Œæ•´çš„å®¢æœæœºå™¨äººç³»ç»Ÿ
---

# æ™ºèƒ½å®¢æœæœºå™¨äººç¤ºä¾‹

æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å®¢æœæœºå™¨äººï¼Œæ”¯æŒå¤šè½®å¯¹è¯ã€çŸ¥è¯†åº“æŸ¥è¯¢ã€‚

## å®Œæ•´ä»£ç 

```go
package main

import (
    "bufio"
    "context"
    "fmt"
    "log"
    "os"
    "strings"

    "github.com/wordflowlab/agentsdk/pkg/agent"
    "github.com/wordflowlab/agentsdk/pkg/provider"
    "github.com/wordflowlab/agentsdk/pkg/sandbox"
    "github.com/wordflowlab/agentsdk/pkg/store"
    "github.com/wordflowlab/agentsdk/pkg/tools"
    "github.com/wordflowlab/agentsdk/pkg/tools/builtin"
    "github.com/wordflowlab/agentsdk/pkg/types"
)

func main() {
    ctx := context.Background()

    // åˆ›å»ºå·¥å…·æ³¨å†Œè¡¨
    toolRegistry := tools.NewRegistry()
    builtin.RegisterAll(toolRegistry)

    // æ³¨å†ŒçŸ¥è¯†åº“æŸ¥è¯¢å·¥å…·
    toolRegistry.Register(KnowledgeBaseTool())

    // åˆ›å»ºä¾èµ–
    deps := &agent.Dependencies{
        ToolRegistry:     toolRegistry,
        SandboxFactory:   sandbox.NewFactory(),
        ProviderFactory:  provider.NewMultiProviderFactory(),
        Store:            store.NewMemoryStore(),
        TemplateRegistry: agent.NewTemplateRegistry(),
    }

    // åˆ›å»ºå®¢æœæœºå™¨äºº
    ag, err := agent.Create(ctx, &types.AgentConfig{
        TemplateID: "assistant",
        ModelConfig: &types.ModelConfig{
            Provider: "anthropic",
            Model:    "claude-sonnet-4-5",
            APIKey:   os.Getenv("ANTHROPIC_API_KEY"),
        },
        SystemPrompt: `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ã€‚

æœåŠ¡åŸåˆ™ï¼š
- å‹å¥½ã€è€å¿ƒã€ä¸“ä¸š
- å…ˆç†è§£é—®é¢˜ï¼Œå†æä¾›è§£å†³æ–¹æ¡ˆ
- ä½¿ç”¨ç®€æ´æ¸…æ™°çš„è¯­è¨€
- å¿…è¦æ—¶æŸ¥è¯¢çŸ¥è¯†åº“è·å–å‡†ç¡®ä¿¡æ¯

å¤„ç†æµç¨‹ï¼š
1. ç†è§£ç”¨æˆ·é—®é¢˜
2. æŸ¥è¯¢çŸ¥è¯†åº“ï¼ˆå¦‚éœ€è¦ï¼‰
3. æä¾›æ¸…æ™°çš„è§£ç­”
4. è¯¢é—®æ˜¯å¦è¿˜æœ‰å…¶ä»–é—®é¢˜

å›å¤æ ¼å¼ï¼š
- ç§°å‘¼ç”¨æˆ·
- è§£ç­”é—®é¢˜ï¼ˆåˆ†æ­¥éª¤è¯´æ˜ï¼‰
- æä¾›ç›¸å…³é“¾æ¥æˆ–å‚è€ƒ
- ç¤¼è²Œç»“æŸ`,
        Tools: []string{"knowledge_base"},
    }, deps)
    if err != nil {
        log.Fatal(err)
    }
    defer ag.Close()

    // æ¬¢è¿æ¶ˆæ¯
    fmt.Println("========================================")
    fmt.Println("      æ¬¢è¿ä½¿ç”¨æ™ºèƒ½å®¢æœç³»ç»Ÿ")
    fmt.Println("========================================")
    fmt.Println("æˆ‘æ˜¯æ‚¨çš„ä¸“å±å®¢æœåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ")
    fmt.Println("(è¾“å…¥ 'quit' é€€å‡º)")
    fmt.Println("========================================\n")

    // äº¤äº’å¼å¯¹è¯
    scanner := bufio.NewScanner(os.Stdin)
    for {
        fmt.Print("æ‚¨: ")
        if !scanner.Scan() {
            break
        }

        input := strings.TrimSpace(scanner.Text())
        if input == "" {
            continue
        }
        if input == "quit" || input == "exit" {
            fmt.Println("\nå®¢æœ: æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼Œç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼ğŸ‘‹")
            break
        }

        // å‘é€æ¶ˆæ¯
        result, err := ag.Chat(ctx, input)
        if err != nil {
            log.Printf("é”™è¯¯: %v", err)
            continue
        }

        // æ‰“å°å“åº”
        fmt.Printf("\nå®¢æœ: %s\n\n", result.Message.Content)
    }
}

// çŸ¥è¯†åº“æŸ¥è¯¢å·¥å…·
func KnowledgeBaseTool() tools.Tool {
    return tools.Tool{
        Name:        "knowledge_base",
        Description: "æŸ¥è¯¢äº§å“çŸ¥è¯†åº“ï¼Œè·å–å‡†ç¡®çš„äº§å“ä¿¡æ¯ã€ä½¿ç”¨è¯´æ˜ã€å¸¸è§é—®é¢˜è§£ç­”",
        InputSchema: map[string]interface{}{
            "type": "object",
            "properties": map[string]interface{}{
                "query": map[string]interface{}{
                    "type":        "string",
                    "description": "æŸ¥è¯¢å…³é”®è¯æˆ–é—®é¢˜",
                },
                "category": map[string]interface{}{
                    "type": "string",
                    "enum": []string{"product", "order", "shipping", "refund", "technical"},
                },
            },
            "required": []string{"query"},
        },
        Handler: func(ctx context.Context, tc *tools.ToolContext) (interface{}, error) {
            query := tc.Input["query"].(string)
            category := ""
            if c, ok := tc.Input["category"].(string); ok {
                category = c
            }

            // æ¨¡æ‹ŸçŸ¥è¯†åº“æŸ¥è¯¢
            kb := getKnowledgeBase()
            results := searchKB(kb, query, category)

            return map[string]interface{}{
                "query":   query,
                "results": results,
                "count":   len(results),
            }, nil
        },
    }
}

// æ¨¡æ‹ŸçŸ¥è¯†åº“
func getKnowledgeBase() map[string][]string {
    return map[string][]string{
        "product": {
            "äº§å“å‹å·ï¼šABC-2024ï¼Œä»·æ ¼ï¼šÂ¥2999ï¼Œç‰¹ç‚¹ï¼šé«˜æ€§èƒ½ã€ä½åŠŸè€—",
            "äº§å“è´¨ä¿ï¼š2å¹´å…¨å›½è”ä¿ï¼Œæ”¯æŒ7å¤©æ— ç†ç”±é€€è´§",
        },
        "order": {
            "è®¢å•æŸ¥è¯¢ï¼šè¯·æä¾›è®¢å•å·ï¼Œæ ¼å¼ä¸º ORD-XXXXXX",
            "è®¢å•ä¿®æ”¹ï¼šä¸‹å•å30åˆ†é’Ÿå†…å¯ä¿®æ”¹æ”¶è´§åœ°å€",
        },
        "shipping": {
            "é…é€æ—¶é—´ï¼šä¸‹å•å48å°æ—¶å†…å‘è´§ï¼Œä¸€èˆ¬3-5ä¸ªå·¥ä½œæ—¥é€è¾¾",
            "ç‰©æµè·Ÿè¸ªï¼šå¯é€šè¿‡è®¢å•å·åœ¨å®˜ç½‘æŸ¥è¯¢ç‰©æµä¿¡æ¯",
        },
        "refund": {
            "é€€æ¬¾æµç¨‹ï¼šæäº¤é€€æ¬¾ç”³è¯·â†’å•†å®¶å®¡æ ¸â†’é€€è´§â†’é€€æ¬¾åˆ°è´¦",
            "é€€æ¬¾æ—¶é—´ï¼šå®¡æ ¸é€šè¿‡å3-7ä¸ªå·¥ä½œæ—¥åˆ°è´¦",
        },
        "technical": {
            "å¸¸è§é—®é¢˜ï¼šæ— æ³•å¼€æœº - æ£€æŸ¥ç”µæºè¿æ¥ï¼Œé•¿æŒ‰ç”µæºé”®10ç§’",
            "æŠ€æœ¯æ”¯æŒï¼šæ‹¨æ‰“400-xxx-xxxxæˆ–å‘é€é‚®ä»¶è‡³support@example.com",
        },
    }
}

func searchKB(kb map[string][]string, query string, category string) []string {
    var results []string

    searchIn := func(items []string) {
        for _, item := range items {
            if strings.Contains(strings.ToLower(item), strings.ToLower(query)) {
                results = append(results, item)
            }
        }
    }

    if category != "" {
        if items, ok := kb[category]; ok {
            searchIn(items)
        }
    } else {
        // æœç´¢æ‰€æœ‰ç±»åˆ«
        for _, items := range kb {
            searchIn(items)
        }
    }

    return results
}
```

## è¿è¡Œç¤ºä¾‹

```bash
export ANTHROPIC_API_KEY="sk-ant-xxx"
go run main.go
```

## å¯¹è¯ç¤ºä¾‹

```
========================================
      æ¬¢è¿ä½¿ç”¨æ™ºèƒ½å®¢æœç³»ç»Ÿ
========================================
æˆ‘æ˜¯æ‚¨çš„ä¸“å±å®¢æœåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ
(è¾“å…¥ 'quit' é€€å‡º)
========================================

æ‚¨: ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹ä½ ä»¬çš„äº§å“

å®¢æœ: æ‚¨å¥½ï¼å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚

æˆ‘ä»¬çš„ä¸»æ¨äº§å“ä¿¡æ¯å¦‚ä¸‹ï¼š
- å‹å·ï¼šABC-2024
- ä»·æ ¼ï¼šÂ¥2,999
- ä¸»è¦ç‰¹ç‚¹ï¼š
  â€¢ é«˜æ€§èƒ½å¤„ç†å™¨
  â€¢ ä½åŠŸè€—è®¾è®¡
  â€¢ 2å¹´å…¨å›½è”ä¿
  â€¢ æ”¯æŒ7å¤©æ— ç†ç”±é€€è´§

è¯·é—®æ‚¨å¯¹å“ªæ–¹é¢ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Ÿæˆ‘å¯ä»¥ä¸ºæ‚¨è¯¦ç»†ä»‹ç»ã€‚ğŸ˜Š

æ‚¨: å¦‚æœæˆ‘ä¹°äº†ä¸æ»¡æ„å¯ä»¥é€€å—ï¼Ÿ

å®¢æœ: å½“ç„¶å¯ä»¥ï¼æˆ‘ä»¬æ”¯æŒé€€è´§æœåŠ¡ã€‚

**é€€è´§æ”¿ç­–ï¼š**
1. âœ… 7å¤©æ— ç†ç”±é€€è´§
2. ğŸ“¦ äº§å“éœ€ä¿æŒå®Œå¥½ï¼ŒåŒ…è£…å®Œæ•´
3. ğŸ’³ é€€æ¬¾ä¼šåŸè·¯è¿”å›

**é€€æ¬¾æµç¨‹ï¼š**
1. æäº¤é€€æ¬¾ç”³è¯·
2. å•†å®¶å®¡æ ¸ï¼ˆ1-2ä¸ªå·¥ä½œæ—¥ï¼‰
3. é€€è´§å¯„å›
4. é€€æ¬¾åˆ°è´¦ï¼ˆå®¡æ ¸é€šè¿‡å3-7ä¸ªå·¥ä½œæ—¥ï¼‰

**æ¸©é¦¨æç¤ºï¼š** å»ºè®®æ‚¨åœ¨æ”¶åˆ°å•†å“åå°½å¿«æ£€æŸ¥ï¼Œå¦‚æœ‰é—®é¢˜åŠæ—¶è”ç³»æˆ‘ä»¬ã€‚

è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ

æ‚¨: ç‰©æµå¤§æ¦‚å¤šä¹…èƒ½åˆ°ï¼Ÿ

å®¢æœ: å…³äºç‰©æµæ—¶æ•ˆï¼Œæˆ‘æ¥ä¸ºæ‚¨è¯´æ˜ï¼š

**å‘è´§æ—¶é—´ï¼š** ä¸‹å•å48å°æ—¶å†…å‘è´§

**é…é€æ—¶é—´ï¼š** ä¸€èˆ¬3-5ä¸ªå·¥ä½œæ—¥é€è¾¾ï¼ˆå…·ä½“å–å†³äºæ‚¨çš„æ”¶è´§åœ°å€ï¼‰

**ç‰©æµè¿½è¸ªï¼š**
- å‘è´§åä¼šæ”¶åˆ°çŸ­ä¿¡é€šçŸ¥
- å¯é€šè¿‡è®¢å•å·åœ¨å®˜ç½‘æŸ¥è¯¢å®æ—¶ç‰©æµ
- æˆ–ç›´æ¥å’¨è¯¢æˆ‘ä»¬å®¢æœ

**åŠ æ€¥æœåŠ¡ï¼š** å¦‚éœ€åŠ æ€¥ï¼Œå¯é€‰æ‹©é¡ºä¸°å¿«é€’ï¼ˆéœ€é¢å¤–ä»˜è´¹ï¼‰

æ‚¨çš„æ”¶è´§åœ°å€åœ¨å“ªä¸ªåŸå¸‚ï¼Ÿæˆ‘å¯ä»¥å¸®æ‚¨é¢„ä¼°æ›´å‡†ç¡®çš„æ—¶é—´ã€‚

æ‚¨: å¥½çš„ï¼Œè°¢è°¢

å®¢æœ: ä¸å®¢æ°”ï¼å¾ˆé«˜å…´èƒ½å¸®åˆ°æ‚¨ã€‚ğŸ˜Š

å¦‚æœæ‚¨å†³å®šä¸‹å•æˆ–æœ‰ä»»ä½•å…¶ä»–é—®é¢˜ï¼Œéšæ—¶è”ç³»æˆ‘ä»¬ï¼š
- ğŸ“ å®¢æœçƒ­çº¿ï¼š400-xxx-xxxx
- ğŸ“§ é‚®ç®±ï¼šsupport@example.com
- ğŸ’¬ åœ¨çº¿å®¢æœï¼šå·¥ä½œæ—¥ 9:00-18:00

ç¥æ‚¨è´­ç‰©æ„‰å¿«ï¼

æ‚¨: quit

å®¢æœ: æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼Œç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼ğŸ‘‹
```

## åŠŸèƒ½æ‰©å±•

### 1. æ„å›¾è¯†åˆ«

```go
SystemPrompt: `è¯†åˆ«ç”¨æˆ·æ„å›¾å¹¶åˆ†ç±»ï¼š
- å’¨è¯¢äº§å“ â†’ æŸ¥è¯¢äº§å“ä¿¡æ¯
- è®¢å•æŸ¥è¯¢ â†’ æŸ¥è¯¢è®¢å•çŠ¶æ€
- æŠ•è¯‰å»ºè®® â†’ è½¬äººå·¥å®¢æœ
- æŠ€æœ¯æ”¯æŒ â†’ æŸ¥è¯¢æŠ€æœ¯æ–‡æ¡£`
```

### 2. å¤šè¯­è¨€æ”¯æŒ

```go
// æ£€æµ‹è¯­è¨€å¹¶åˆ‡æ¢
result, _ := ag.Chat(ctx, "Detect language and respond in the same language")
```

### 3. æƒ…æ„Ÿåˆ†æ

```go
// è¯†åˆ«ç”¨æˆ·æƒ…ç»ªï¼Œè°ƒæ•´å›å¤è¯­æ°”
SystemPrompt: `åˆ†æç”¨æˆ·æƒ…ç»ªï¼š
- ç”Ÿæ°”/ä¸æ»¡ â†’ é“æ­‰ã€å®‰æŠšã€å¿«é€Ÿè§£å†³
- ç–‘æƒ‘/å›°æ‰° â†’ è€å¿ƒè§£é‡Šã€æä¾›è¯¦ç»†æ­¥éª¤
- æ»¡æ„/æ„Ÿè°¢ â†’ è¡¨è¾¾æ„Ÿè°¢ã€è¯¢é—®å…¶ä»–éœ€æ±‚`
```

### 4. å·¥å•ç³»ç»Ÿé›†æˆ

```go
// åˆ›å»ºå·¥å•
toolRegistry.Register(CreateTicketTool())

result, _ := ag.Chat(ctx, "è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œå¸®æˆ‘åˆ›å»ºä¸€ä¸ªæŠ€æœ¯æ”¯æŒå·¥å•")
```

## ç›¸å…³èµ„æº

- [å¤šè½®å¯¹è¯](../1.agent/4.multi-turn)
- [è‡ªå®šä¹‰å·¥å…·](../3.tools/3.custom-tool)
- [Session ç®¡ç†](../../guides/session)
